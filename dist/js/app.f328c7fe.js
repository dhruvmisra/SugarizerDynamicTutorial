(function(t){function e(e){for(var r,o,s=e[0],l=e[1],c=e[2],d=0,u=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);h&&h(e);while(u.length)u.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(r=!1)}r&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},i={app:0},a=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/SugarizerDynamicTutorial/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var h=l;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"02e7":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 1h30mn)*\r\n\r\nWhat if the Pawn activity could be played by multiple players at the same time? After all, it\'s a logical feature for a game. That\'s what we will be doing in this step.\r\n\r\n# Connect to a server\r\n\r\nFrom the beginning of this tutorial, we use Sugarizer stand alone. All HTML and JavaScript are run locally and do not depend on external code. For this step however, because we need to have communication between multiple clients, we will need a Sugarizer Server too. The Sugarizer Server is a backend that provides connection features to Sugarizer Apps.\r\n\r\nYou could install a Sugarizer Server locally following instruction [here](https://github.com/llaske/sugarizer-server/blob/master/README.md) or use the test server available on [https://dev.sugarizer.org](https://dev.sugarizer.org).\r\n\r\nTo see if you\'re connected to a server, click on the Neighborhood view - the icon with multiple dots - on the Sugarizer toolbar. Because you\'re not connected yet, here is the message you will see:\r\n\r\n![](images/tutorial_step6_1.png)\r\n\r\nTo connect to a server, click on the button to access to settings, then to "About my server" icon to display the server settings window.\r\n\r\n![](images/tutorial_step6_2.png)\r\n\r\nCheck the connected box and type the URL of your server, may be `http://localhost:8080` (if you\'ve installed your own server) or `https://dev.sugarizer.org`. You will have to choose few images as password, then click on restart.\r\n\r\nIf everything is right, you will see now the full Neighborhood view.\r\n\r\n![](images/tutorial_step6_3.png)\r\n\r\nAnd you\'re now connected.\r\n\r\n\r\n# What is meant by sharing an instance\r\n\r\nSuppose that Michaël, a user connected on the same server as you want to Chat. He will launch the Chat activity.\r\n\r\n![](images/tutorial_step6_4.png)\r\n\r\n***Tip***: *To connect to Sugarizer with two users on the same computer, open a new "in private" browser window. So you will be able to create a new user. It\'s what we\'ve done here and what we\'ll do below to simulate the user Michaël.*\r\n\r\nThen, once the activity is open, he can share the activity by clicking on the toolbar Neighborhood button in the Network palette. It\'s a way for the user to say: *"I want to share my activity on the network"*.  \r\n\r\n![](images/tutorial_step6_5.png)\r\n\r\nFrom your Neighborhood view you will see the icon of the activity suddenly appear near the Michaël\'s icon. Just pass the mouse on the activity icon and click the Join menu and you will be able to join Michaël.\r\n\r\n![](images/tutorial_step6_6.png).\r\n\r\nThe Chat activity will open on your side using Michaël colors, and the Chat can start between users.\r\n\r\n![](images/tutorial_step6_7.png)\r\n\r\nEasy, isn\'t it ? And thanks to the unique Sugarizer presence framework, do the same thing for our Pawn activity will not be so complex.\r\n\r\n\r\n# Add the presence palette\r\n\r\nAll activities that could be shared have to include the Network palette in its toolbar. Like in the Chat activity it\'s the way for the user to share its current work and allow other users to join. Let\'s do it in Pawn activity.\r\n\r\nFirst start by adding a button for the network in the `index.html` file. We add it just after the existing `add` button.\r\n```html\r\n<button class="toolbutton" id="network-button" title="Network"></button>\r\n```\r\nWe will now define this new button in the `css/activity.css` file. We define also the two buttons included in the palette. Note that all icons are already included in the `lib/sugar-web/graphics/icons/actions` directory.\r\n```css\r\n#main-toolbar #network-button {\r\n\tbackground-image: url(../lib/sugar-web/graphics/icons/actions/zoom-home.svg);\r\n}\r\n\r\n#private-button {\r\n\tbackground-image: url(../lib/sugar-web/graphics/icons/actions/zoom-home.svg);\r\n\twidth: 47px;\r\n\theight: 47px;\r\n\tmargin: 4px 2px;\r\n\tcolor: white;\r\n\tcolor: transparent;\r\n\tbackground-color: transparent;\r\n\tbackground-position: center;\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-size: contain;\r\n\tborder: 0;\r\n\tborder-radius: 5.5px;\r\n}\r\n\r\n#shared-button {\r\n\tbackground-image: url(../lib/sugar-web/graphics/icons/actions/zoom-neighborhood.svg);\r\n\twidth: 47px;\r\n\theight: 47px;\r\n\tmargin: 4px 2px;\r\n\tcolor: white;\r\n\tcolor: transparent;\r\n\tbackground-color: transparent;\r\n\tbackground-position: center;\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-size: contain;\r\n\tborder: 0;\r\n\tborder-radius: 5.5px;\r\n}\r\n```\r\nThe name "palette" refers to a popup menu in the toolbar. When the user clicks on the toolbar icon, the popup appears and display items inside - most often other buttons. To handle this feature Sugar-Web exposes a Palette library and, more precisely, a PresencePalette too. \r\n\r\nAs usual, to integrate this library, we will update the dependencies list at the first line of `activity/activity.js`.\r\n```js\r\ndefine(["sugar-web/activity/activity", "sugar-web/env", "sugar-web/graphics/icon", "webL10n","sugar-web/graphics/presencepalette"], function (activity, env, icon, webL10n, presencepalette) {\r\n```\r\nThis palette must be initialized in the code. You just have to call the PresencePalette constructor with the toolbar element. So add this line in the end of the require function of `activity/activity.js`:\r\n```js\r\n// Link presence palette\r\nvar palette = new presencepalette.PresencePalette(document.getElementById("network-button"), undefined);\r\n```\r\nLet\'s test the result by launching our Pawn activity.\r\n\r\n![](images/tutorial_step6_8.png)\r\n\r\nThe new Network button and palette is here. We now have to implement the magic inside.\r\n\r\n\r\n# How presence works\r\n\r\nBefore further implementation let\'s pause to explain what exactly Sugarizer presence framework is and what it does.\r\n\r\nThe presence framework provides a real time communication between a set of clients. To do that the framework is based on the [publish/subscribe](https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern) pattern. Every client could create one or more **topics**. Other clients could **subscribe** to these topics and everyone could **publish** messages on a topic. When a message is published on a topic, only clients connected to this topic receive the message.\r\n\r\nIn the context of Sugarizer, clients are Sugarizer App/WebApp connected to the Server. One topic is a shared activity. The Sugarizer Server is responsible to keep the list of topics and clients and dispatch messages to clients subscribed to topics. So the server is the central point and in fact, clients communicate only with the server.\r\n\r\nLet\'s take an example. Michaël, Lionel and Bastien are three users connected to the same Sugarizer Server. Michaël shares a Chat activity. Lionel decides to join the activity. Bastien shares its own Paint activity but he\'s alone on the activity.\r\n\r\n![](images/tutorial_step6_9.png)\r\n\r\nThe server knows that two activities are shared: one Chat activity with Michaël and Lionel as subscribers, one Paint activity with only Bastien as subscriber.\r\n\r\nIf Michaël posts a message for the Chat activity, the server will automatically send back the message to Michaël and Lionel but not to Bastien.\r\n\r\nEasy to understand isn\'t it?\r\n\r\n\r\n# Share the instance\r\n\r\nNow, let\'s update our Pawn activity to integrate presence. Start first by handling the click on the Share button. We will add a listener to handle `shared` event of the palette in the `activity/activity.js` file. \r\n```js\r\n// Link presence palette\r\nvar presence = null;\r\nvar palette = new presencepalette.PresencePalette(document.getElementById("network-button"), undefined);\r\npalette.addEventListener(\'shared\', function() {\r\n\tpalette.popDown();\r\n\tconsole.log("Want to share");\r\n\tpresence = activity.getPresenceObject(function(error, network) {\r\n\t\tif (error) {\r\n\t\t\tconsole.log("Sharing error");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnetwork.createSharedActivity(\'org.sugarlabs.Pawn\', function(groupId) {\r\n\t\t\tconsole.log("Activity shared");\r\n\t\t});\r\n\t\tnetwork.onDataReceived(onNetworkDataReceived);\r\n\t});\r\n});\r\n```\r\nIn this listener, we have to retrieve the presence object. As usual, it\'s exposed by the `activity` object. So you just need a call to `activity.getPresenceObject` method. If everything goes well, you will retrieve a presence object. That\'s a way to indicate that you\'re connected to a server.\r\n\r\nThe `createSharedActivity` on this object allows you to create a new shared activity. You must pass as parameter the type of the activity so Sugarizer could display the right icon in the neighborhood view. Then you receive the unique identifier of the share in the `groupId` parameter of the callback.\r\n\r\nFinally, we register a callback to handle the message received, with a call to `onDataReceived` method. We will have a look on this callback later.\r\n\r\nNow that our activity is shared, we have to slightly update the Plus button listener. Because now we should notify other users when a new pawn is played. Here\'s how the new listener will look like:\r\n```js\r\n// Handle click on add\r\ndocument.getElementById("add-button").addEventListener(\'click\', function (event) {\r\n\r\n\tpawns.push(currentenv.user.colorvalue);\r\n\tdrawPawns();\r\n\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Played", {name:currentenv.user.name})+"</h1>";\r\n\r\n\tif (presence) {\r\n\t\tpresence.sendMessage(presence.getSharedInfo().id, {\r\n\t\t\tuser: presence.getUserInfo(),\r\n\t\t\tcontent: currentenv.user.colorvalue\r\n\t\t});\r\n\t}\r\n});\r\n```\r\n\r\nIf the activity is connected (i.e. presence is not null), we call the `sendMessage` method. As its name implies, `sendMessage` is the method to send a message to the server. The first parameter of this method is the id of the share. We could retrieve this id from the presence object by `getSharedInfo().id`. The second parameter is just the message. We decided to split the message in two parts: information about `user` that sent the message and the `content`, the user color. The user info is get from presence object using the `getUserInfo()` call: it will retrieve an object with `name`, `networkId` and `colorvalue`.\r\n\r\nThat\'s all we need to create a shared activity and let it appear on the Neighborhood view of other users. We have now to handle what happens when a user clicks on the Join menu. In that case, your activity is automatically open by Sugarizer with a specific parameter in the environment. So we will update the `getEnvironment` call in the `activity/activity.js` file to handle this case:\r\n\r\n```js\r\nenv.getEnvironment(function(err, environment) {\r\n\tcurrentenv = environment;\r\n\r\n\t// Set current language to Sugarizer\r\n\t...\r\n\r\n\t// Load from datatore\r\n\tif (!environment.objectId) {\r\n\t\t...\r\n\t}\r\n\r\n\t// Shared instances\r\n\tif (environment.sharedId) {\r\n\t\tconsole.log("Shared instance");\r\n\t\tpresence = activity.getPresenceObject(function(error, network) {\r\n\t\t\tnetwork.onDataReceived(onNetworkDataReceived);\r\n\t\t});\r\n\t}\r\n});\r\n```\r\nWhat we\'ve added in this source code is: if `environment.sharedId` is not null - i.e. the activity was launched from the Join menu - we get the presence object and declare the callback to process data received. \r\n\r\nThe `onNetworkDataReceived` callback is the same one we used previously. So it\'s a good idea now to see what this callback should do.\r\n```js\r\nvar onNetworkDataReceived = function(msg) {\r\n\tif (presence.getUserInfo().networkId === msg.user.networkId) {\r\n\t\treturn;\r\n\t}\r\n\tpawns.push(msg.content);\r\n\tdrawPawns();\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Played", {name:msg.user.name})+"</h1>";\r\n}; \r\n```\r\nThis callback is called each time a message is received from the server. The message is the parameter for the callback. We first test the `networkId` in this message to ignore the message that we sent ourselves. Then we add the message `content` (i.e. colors for the user sending the message) to our `pawns` array and redraw the board with the `drawPawns()` call. Finally, we update the welcome message to give the player\'s name.\r\n\r\nLet\'s try if everything works. From the Michaël browser, launch a new Pawn activity and share it with the network menu.\r\n\r\n![](images/tutorial_step6_10.png)\r\n\r\nOpen the Lionel browser on the neighborhood view. You should see the shared Pawn activity.\r\n\r\n![](images/tutorial_step6_11.png)\r\n\r\nJoin the activity by clicking on the Join menu. The activity should open with the Michaël colors.\r\n\r\n![](images/tutorial_step6_12.png)\r\n\r\nClick on the Plus button on the Lionel or Michaël browser: each time a pawn with the right color should be added to both windows.\r\n\r\n![](images/tutorial_step6_13.png)\r\n\r\nGreat isn\'t it? \r\n\r\nAnd it works for any number of users connected at the same time on the shared activity!\r\n\r\n# Handling subscribers change\r\n\r\nLet\'s go a bit further or more precisely, let\'s fix a small issue in the previous implementation. \r\n\r\nIf Michaël starts to play some pawns on the board before Lionel joins the activity, there will be a difference between the boards:\r\n\r\n![](images/tutorial_step6_14.png)\r\n\r\nIt\'s like initial plays from Michaël was lost.\r\n\r\nThis issue is related to the way of handling users that join the activity. Currently nothing is done to give them the initial board state. So they only saw new changes on the board. It could make sense for a chat activity: users who join a chat could not be able to see past discussions. But for our activity, it\'s not a good thing.\r\n\r\nTo fix it, let\'s subscribe to a new presence callback named `onSharedActivityUserChanged`. So we will add two times - in `shared` listener and in `getEnvironment` under `network.onDataReceived` call - the following line in `activity/activity.js` file:\r\n```js\r\nnetwork.onSharedActivityUserChanged(onNetworkUserChanged);\r\n```\r\nHere\'s a first simple implementation for this new callback:\r\n```js\r\nvar onNetworkUserChanged = function(msg) {\r\n\tconsole.log("User "+msg.user.name+" "+(msg.move == 1 ? "join": "leave"));\r\n};\r\n```\r\nThe `onSharedActivityUserChanged` message is sent automatically by the server when the subscriber\'s list for a shared activity has changed. You will receive in the message a `move` field telling if the user has joined (the `move` value is `1`) or left (the `move` value is `-1`). And you will receive in the `user` field of the message informations (`name`, `networkId` and `colorvalue`) about the user. \r\n\r\nThe `onSharedActivityUserChanged` message is useful to display a list of users currently connected, and for example displaying this list. Thanks to this message we will be able too to fix our current issue.\r\n\r\nThe idea is to identify the host for the share (Michaël in our sample). When a new subscriber joins the share, the host - and only the host - send to the new subscriber a message with the current board state.\r\nBut because the current message contains only the color for the added pawn, we have to create a new type of message for that. Here\'s the suggested implementation to do that.\r\n\r\nFirst let\'s modify the current send message call to integrate the \'update\' message type to keep compatibility with current implementation:\r\n```js\r\npresence.sendMessage(presence.getSharedInfo().id, {\r\n\tuser: presence.getUserInfo(),\r\n\tcontent: {\r\n\t\taction: \'update\',\r\n\t\tdata: currentenv.user.colorvalue\r\n\t}\r\n});\r\n```\r\nLet\'s tell the host to send the new \'init\' message type when the subscriber list change:\r\n```js\r\nvar onNetworkUserChanged = function(msg) {\r\n\tif (isHost) {\r\n\t\tpresence.sendMessage(presence.getSharedInfo().id, {\r\n\t\t\tuser: presence.getUserInfo(),\r\n\t\t\tcontent: {\r\n\t\t\t\taction: \'init\',\r\n\t\t\t\tdata: pawns\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tconsole.log("User "+msg.user.name+" "+(msg.move == 1 ? "join": "leave"));\r\n}; \r\n```\r\nThen we need to update the `onNetworkDataReceived` callback to handle the new message structure:\r\n```js\r\nvar onNetworkDataReceived = function(msg) {\r\n\tif (presence.getUserInfo().networkId === msg.user.networkId) {\r\n\t\treturn;\r\n\t}\r\n\tswitch (msg.content.action) {\r\n\t\tcase \'init\':\r\n\t\t\tpawns = msg.content.data;\r\n\t\t\tdrawPawns();\r\n\t\t\tbreak;\r\n\t\tcase \'update\':\r\n\t\t\tpawns.push(msg.content.data);\r\n\t\t\tdrawPawns();\r\n\t\t\tdocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Played", {name:msg.user.name})+"</h1>";\r\n\t\t\tbreak;\r\n\t}\r\n};\r\n```\r\nFinally we will implement host detection with a new `isHost` variable. The host is the one who created the share:\r\n```js\r\nvar isHost = false;\r\npalette.addEventListener(\'shared\', function() {\r\n\tpalette.popDown();\r\n\tconsole.log("Want to share");\r\n\tpresence = activity.getPresenceObject(function(error, network) {\r\n\t\tif (error) {\r\n\t\t\tconsole.log("Sharing error");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnetwork.createSharedActivity(\'org.sugarlabs.Pawn\', function(groupId) {\r\n\t\t\tconsole.log("Activity shared");\r\n\t\t\tisHost = true;\r\n\t\t});\r\n\t\tnetwork.onDataReceived(onNetworkDataReceived);\r\n\t\tnetwork.onSharedActivityUserChanged(onNetworkUserChanged);\r\n\t});\r\n});\r\n```\r\nLet\'s repeat the test by launching the activity from Michaël\'s browser with an initial content (for example from the Journal).\r\n\r\n![](images/tutorial_step6_15.png)\r\n\r\nIt fully works now!\r\n\r\nImplementing a multi-user application is not an easy task but with a nice framework like Sugarizer presence, I\'m sure you\'re convinced now that it\'s feasible!'},"034f":function(t,e,n){"use strict";var r=n("85ec"),i=n.n(r);i.a},"0873":function(t){t.exports=JSON.parse('{"steps":{"0":{"title":"Set up the development environment","file":"step0.md"},"1":{"title":"Create the activity from the template","file":"step1.md"},"2":{"title":"Customize icon and content","file":"step2.md"},"3":{"title":"Add a toolbar button","file":"step3.md"},"4":{"title":"Handle journal and datastore","file":"step4.md"},"5":{"title":"Localize the activity","file":"step5.md"},"6":{"title":"Handle multi-user with presence","file":"step6.md"},"7":{"title":"Use journal chooser dialog","file":"step7.md"},"8":{"title":"Create your own palette","file":"step8.md"},"9":{"title":"Integrate a tutorial","file":"step9.md"}}}')},1771:function(t,e,n){var r={"./VanillaJS/step0.md":"e5fc","./VanillaJS/step1.md":"20ba","./VanillaJS/step2.md":"901b","./VanillaJS/step3.md":"b229","./VanillaJS/step4.md":"c34c","./VanillaJS/step5.md":"4dc6","./VanillaJS/step6.md":"02e7","./VanillaJS/step7.md":"3c11","./VanillaJS/step8.md":"d6c5","./VanillaJS/step9.md":"9690","./VueJS/step0.md":"9d8c","./VueJS/step1.md":"680e","./VueJS/step2.md":"639c","./VueJS/step3.md":"1c51","./VueJS/step4.md":"3f8c5","./VueJS/step5.md":"60e8","./languages/VanillaJS":"7700","./languages/VanillaJS.js":"7700","./languages/VueJS":"be2f","./languages/VueJS.js":"be2f","./logo.png":"cf05"};function i(t){var e=a(t);return n(e)}function a(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=a,t.exports=i,i.id="1771"},"1c51":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nIt\'s time now to implement the logic of our new activity.\r\n\r\nBecause the activity is called "Pawn", the idea is to allow the user to play pawns on the board.\r\n\r\nIn Sugar, the toolbar - the black area at the top of the window - is the place where activities put actions for the user. So we will add a new button in the toolbar to let the user play a new pawn.\r\n\r\n# Create a new toolbar button\r\n\r\nHere is the icon we will use. It\'s just a stylized plus sign.\r\n\r\n![](images/tutorial_step3_1.png)\r\n\r\nYou could download it [here](images/add.svg). Right-click on it and then save it as a SVG file in `icons/add.svg`.\r\n\r\n***Warning***: *The plus sign is white on a transparent background so you will see nothing if you display it on a white background.*\r\n\r\nTo add this icon in the toolbar, we will first update the `index.html` file for your activity. Look for the sugar-toolbar section in the file. It looks like this:\r\n```html\r\n<sugar-toolbar ref="SugarToolbar">\r\n  <sugar-toolitem id="activity-button"></sugar-toolitem>\r\n  <sugar-toolitem splitbar></sugar-toolitem>\r\n\r\n  \x3c!-- Add more buttons here --\x3e\r\n  \r\n\r\n  \x3c!-- Toolitems with class="pull-right" will be right aligned --\x3e\r\n  <sugar-toolitem id="stop-button" title="Stop" class="pull-right"></sugar-toolitem>\r\n</sugar-toolbar>\r\n```\r\n\r\nThe component `js/components/SugarToolbar.js` defines two components: `sugar-toolbar` nad `sugar-toolitem` (buttons).\r\n\r\nLet\'s add our new button. It\'s just an instance of `sugar-toolitem` component. We give it the value `add-button` for the `id` property. Here is the result:\r\n```html\r\n<sugar-toolbar ref="SugarToolbar">\r\n  <sugar-toolitem id="activity-button"></sugar-toolitem>\r\n  <sugar-toolitem splitbar></sugar-toolitem>\r\n\r\n  \x3c!-- Add more buttons here --\x3e\r\n  <sugar-toolitem id="add-button" title="Add Pawn"></sugar-toolitem>\r\n\r\n  \x3c!-- Toolitems with class="pull-right" will be right aligned --\x3e\r\n  <sugar-toolitem id="stop-button" title="Stop" class="pull-right"></sugar-toolitem>\r\n</sugar-toolbar>\r\n```\r\n\r\nWe will now associate the icon to this new button. This association should be done in the `css/activity.css` file. Add these lines at the end of the file.\r\n```css\r\n#main-toolbar #add-button {\r\n\tbackground-image: url(../icons/add.svg);\r\n}\r\n```\r\nLet\'s run the activity.\r\n\r\n![](images/tutorial_step3_2.png)\r\n\r\nThe new toolbar button is now here. Click on it. Of course, nothing happens thought there is no logic beside. It\'s our next step.\r\n\r\n# Add the event\r\n\r\nTo display pawns on the board, we will first update our `index.html` file.\r\n\r\nAdd a new `div` tag below the one created for the welcome message:\r\n```html\r\n<div id="user">\r\n  <h1>{{ displayText }}</h1>\r\n</div>\r\n<div id="pawns"></div>\r\n```\r\nWe give the value `pawns` for the attribute `id` because it will contain all pawns on the board.\r\n\r\nTo draw the pawn we will reuse our nice pawn icon. So each time there will be a click on the Plus button, we will add a new pawn icon on the board.\r\n\r\nLet\'s update the `activity/activity.js` to add this. But first, we will slightly adapt our `getEnvironment` call. We just add a `currentenv` data variable to store the environment to avoid multiple call of the `getEnvironment` method:\r\n```js\r\ndata: {\r\n  currentenv: null,\r\n  displayText: \'\'\r\n},\r\nmethods: {\r\n  initializeActivity: function () {\r\n    // Initialize Sugarizer\r\n    this.$refs.SugarActivity.setup();\r\n\r\n    this.currentenv = this.$refs.SugarActivity.getEnvironment();\r\n    this.displayText = "Hello " + this.currentenv.user.name + "!";\t\r\n  },\r\n}\r\n```\r\nThen just after the `initializeActivity`, we will add the following method to handle click event and a new `pawns` array:\r\n```js\r\ndata: {\r\n  ...\r\n  pawns: []\r\n},\r\nmethods: {\r\n  ...\r\n  onAddClick: function () {\r\n    this.pawns.push(this.currentenv.user.colorvalue);\r\n    this.displayText = this.currentenv.user.name + " played";\r\n  },\r\n}\r\n```\r\n\r\nThis method adds the colors of the user to the array on click. The method also updates the `displayText` to show who made the move. We will use this pawns array to dynamically render pawns to the screen using `v-for`, like this:\r\n```html\r\n<div id="pawns">\r\n  <div class="pawn" v-for="(pawn, i) in pawns" v-bind:key="i"></div>\r\n</div>\r\n```\r\n\r\nNow, call this method using `v-on:click` directive on the add pawn button.\r\n```html\r\n<sugar-toolitem id="add-button" title="Add Pawn" v-on:click="onAddClick"></sugar-toolitem>\r\n```\r\n\r\nMake sense? Yes, except that something is missing: the link between the `div` created for the pawn and the pawn icon itself. To do that we have to update the `css/activity.css` file. Add these lines at the end of the file:\r\n```css\r\n.pawn {\r\n\tbackground-image: url(../icons/pawn-icon.svg);\r\n\tdisplay: inline-block;\r\n\twidth: 65px;\r\n\theight: 65px;\r\n}\r\n```\r\nIt defined a new CSS class named `pawn`, give it few cosmetic properties and specifically our pawn icon as background.\r\n\r\nCan\'t wait to run again our activity:\r\n\r\n![](images/tutorial_step3_3.png)\r\n\r\nWow, it works! Each time we will click on the Plus icon a new pawn will appear.\r\n\r\nBy the way, we could do better. What if we could change the pawn color?\r\n\r\n# Customize the icon (again)\r\n\r\nSugar activities very often rely on the user colors. It\'s a way to let the user think he could customize the color of activities. So, it\'s a good way to better engage him into the activity.\r\n\r\nWe decide to update our activity to paint the pawn with the user color. You could think it\'s complex: it\'s not! Just a call to another Sugar-Web library named **icon**.\r\n\r\nLet\'s create a **Pawn** component to handle this behaviour of the pawn icon. Create `js/Pawn.js` and add the following code:\r\n```js\r\nvar Pawn = {\r\n  template: `<div ref="pawn" class="pawn"></div>`,\r\n  props: [\'colors\']\r\n}\r\n```\r\nThis component takes `colors` as a prop. Now, whenever this component is mounted, we want to set the color of the icon to the colors passed to it as props. Let\'s add the mounted hook and require the icon library.\r\n```js\r\nmounted() {\r\n  var vm = this;\r\n  requirejs(["sugar-web/graphics/icon"], function (icon) {\r\n    // We\'ll use icon here\r\n  })\r\n}\r\n```\r\n\r\nThe icon library contains a magic method called `colorize`. Just give it a reference to a Sugar-Web icon and a color and it will transform the background to a colorize icon.\r\n\r\nLet\'s add a call to this magic method using a reference to the component template and the passed colors.\r\n```js\r\nmounted() {\r\n  var vm = this;\r\n  requirejs(["sugar-web/graphics/icon"], function (icon) {\r\n    icon.colorize(vm.$refs.pawn, vm.colors);\r\n  })\r\n}\r\n```\r\nVery simple, we call the method with two parameters: the new pawn element and the user color that we could find in the environment.\r\n\r\nLet\'s add this component to our Vue instance.\r\n\r\n1. Include the file in`index.html`\r\n```html\r\n  ...\r\n\t<script src="js/Pawn.js"><\/script>\r\n  ...\r\n</body>\r\n```\r\n\r\n2. Register the component in `js/activity.js`\r\n```js\r\ncomponents: {\r\n  \'pawn\': Pawn\r\n},\r\n```\r\n\r\n3. Use the component in `index.html` passing the user colors\r\n```html\r\n<div id="pawns">\r\n  <pawn class="pawn" v-for="(pawn, i) in pawns" v-bind:key="i" v-bind:colors="pawn"></pawn>\r\n</div>\r\n```\r\n\r\nThat\'s all. Let\'s play again with our activity:\r\n\r\n![](images/tutorial_step3_4.png)\r\n\r\nBeautiful isn\'t it?\r\n\r\nNote that if you\'re interested in how to integrate the Sugar UI in your activities, you could find more samples on this subject [here](http://sugarlabs.github.io/sugar-web-samples/).\r\n'},"20ba":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 15mn)*\r\n\r\nSugarizer comes with an empty template that you could use as the base of your new activity. So first, copy all content of the Sugarizer `activities/ActivityTemplate` directory in a new directory called `activities/Pawn.activity`. **Pawn** will be the name for our new activity.\r\n\r\n\r\n### File structure\r\n\r\nIn your new directory, you will find the following file structure:\r\n\r\n![](images/tutorial_step1_1.png)\r\n\r\n\r\n* `activity/` contains information about your activity, including the name, ID, and the icon.\r\n* `index.html` is where the elements that compose your activity are defined.  The template comes with a toolbar and a canvas where you can place your content.\r\n* `js/activity.js` is where the logic of your activity lives.\r\n* `css/activity.css` is where you add the styling of your activity.\r\n\r\nThose are the files you\'ll modify in most cases. The others are:\r\n\r\n* `js/loader.js` configures the libraries paths and loads your   `js/activity.js`\r\n* `lib/` contains the libraries\r\n* `package.json` contains information about the libraries the activity depends on\r\n* `setup.py` is used if you want to run your activity in Sugar.\r\n\r\n\r\n### Customize the activity\r\n\r\nThen customize the activity using your text editor. Change the name for your activity. Write `Pawn` in the activity **name** and `org.sugarlabs.Pawn` in **bundle_id** properties in `activity/activity.info` of the new directory.\r\n```\r\n[Activity]\r\nname = Pawn\r\nactivity_version = 1\r\nbundle_id = org.sugarlabs.Pawn\r\nexec = sugar-activity-web\r\nicon = activity-icon\r\n```\r\nUse your text editor to change the **title** tag of `index.html` to `Pawn Activity`.\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n\r\n<head>\r\n\t<meta charset="utf-8" />\r\n\t<title>Pawn Activity</title>\r\n\t<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"/>\r\n\t<link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\r\n\t\t\thref="lib/sugar-web/graphics/css/sugar-96dpi.css">\r\n\t<link rel="stylesheet" media="screen and (device-width: 1200px) and (device-height: 900px)"\r\n\t\t\thref="lib/sugar-web/graphics/css/sugar-200dpi.css">\r\n\t<link rel="stylesheet" href="css/activity.css">\r\n\t<script data-main="js/loader" src="lib/require.js"><\/script>\r\n</head>\r\n...\r\n```\r\n\r\nFinally, update the file `activities.json` at the root of the Sugarizer directory: add a new line for your activity. Update **id**, **name** and **directory** values on this new line to `org.sugarlabs.Pawn`, `Pawn` and `activities/Pawn.activity`.\r\n```json\r\n\t[\r\n\t\t{"id": "org.sugarlabs.Pawn", "name": "Pawn", "version": 1, "directory": "activities/Pawn.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n\t\t{"id": "org.sugarlabs.GearsActivity", "name": "Gears", "version": 6, "directory": "activities/Gears.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n\t\t{"id": "org.sugarlabs.MazeWebActivity", "name": "Maze Web", "version": 2, "directory": "activities/MazeWeb.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n```\r\nNow run Sugarizer, you should see the icon of a new activity like this:\r\n\r\n![](images/tutorial_step1_2.png)\r\n\r\nLet\'s run the activity by clicking on it. You will see the first step of your activity.\r\n\r\n![](images/tutorial_step1_3.png)\r\n\r\nNow you are ready to go ahead and customize your activity.'},"2b8c":function(t,e,n){"use strict";var r=n("c75e"),i=n.n(r);i.a},"3c11":function(t,e,n){"use strict";n.r(e),e["default"]="*(Estimated time: 15mn)*\r\n\r\nDuring [step 4](tutorial_step4.md) of this tutorial, we've seen how it's possible to store some content into the Journal and reload it into the activity.\r\n\r\nIn this step, we're going to see another way to integrate content from the Journal into your activity using the Journal chooser dialog.\r\n\r\n### From an activity to another\r\n\r\nLet's run the Moon activity from the Sugarizer home view.\r\n\r\nThis activity is a Moon phase viewer. It shows you Lunar phase information and a nice picture of the current Moon phase.\r\nLet's suppose you want to reuse this picture in a drawing. To do that, we're going to save the current view into the Journal as an image.\r\nJust click on the **Export to image** button.\r\n\r\n![](images/tutorial_step7_1.png)\r\n\r\nThen stop the activity and go to the Journal view.\r\nYou can see a new item named \"Image Moon\" for the exported image.\r\n\r\n![](images/tutorial_step7_2.png)\r\n\r\nNow launch the Paint activity and click on the **Insert Image** button in the toolbar.\r\nThe Journal chooser popup will appear.\r\n\r\n![](images/tutorial_step7_3.png)\r\n\r\nClick on the Image Moon item in the list, it will be added to your drawing and you will be able to paint on it!\r\n\r\n![](images/tutorial_step7_4.png)\r\n\r\nIt's a way to use the result of an activity, here Moon, into another activity, here Paint.A Lot of other activities (Record, Labyrinth, Abecedarium, ...) are able to generate contents that other activities (Fototoon, Memorize, Paint, ...) can use. It's why it's useful to understand how the Journal chooser can be integrated into an activity.\r\n\r\n\r\n### A button to customize the background\r\n\r\nLet's suppose that we would like to let the user customize the background of our Pawn activity. So instead of an ugly gray background we could let the user replace it, for example, by a checkboard image.\r\n\r\nTo do that, let's first add a new button **Insert Image** button in the toolbar like the one in the Paint activity.\r\n\r\n![](images/tutorial_step7_5.png)\r\n\r\nFirst, let's retrieve the icon. \r\nYou could download it [here](images/insert-picture.svg). Right-click on it and then save it as a SVG file in `icons/insert-picture.svg`.\r\n\r\nThen, let's add our new button. You already know how to do it because you've done it during [step 3](tutorial_step3.md). You have to update the toolbar section of the `index.html` file for your activity. Add a `button` tag with the Sugar-Web `toolbutton` class. Here is the result:\r\n\r\n\t<div id=\"main-toolbar\" class=\"toolbar\">\r\n\t  ...\r\n\r\n\t  <button class=\"toolbutton\" id=\"picture-button\" title=\"Change background\"></button>\r\n\r\n\t  ...\r\n\t</div>\r\n\r\n\r\nWe will now associate the icon to this new button. This association should be done in the `css/activity.css` file. Add these lines at the end of the file.\r\n\r\n\t#main-toolbar #picture-button {\r\n\t\tbackground-image: url(../icons/insert-picture.svg);\r\n\t}\r\n\r\nLet's run the activity. Good job! the new button is here:\r\n\r\n![](images/tutorial_step7_6.png)\r\n\r\n\r\n### Display the Journal chooser popup\r\n\r\nIt's time now to add source code to display Journal chooser and integrate our background.\r\n\r\n\r\nAs usual, to integrate new features, we will update the dependencies list of libraries at the first line of `activity/activity.js`.\r\n\r\n\tdefine([\"sugar-web/activity/activity\", ... ,\"sugar-web/graphics/presencepalette\", \"sugar-web/datastore\",\"sugar-web/graphics/journalchooser\"], function (activity, ... ,presencepalette, datastore, journalchooser) {\r\n \r\nThis time you need to add two libraries:\r\n\r\n* `sugar-web/datastore` the library for all datastore features\r\n* `sugar-web/graphics/journalchooser` the library to display the Journal chooser dialog.\r\n\r\nLet's now handle click on the new button to display the Journal chooser. Like others buttons in our activity, \r\n we have to add the event listener:\r\n\r\n\t\tdocument.getElementById(\"picture-button\").addEventListener('click', function (e) {\r\n\t\t\tjournalchooser.show(function (entry) {\r\n\t\t\t\t// Do nothing for the moment\r\n\t\t\t}, { mimetype: 'image/png' }, { mimetype: 'image/jpeg' });\r\n\t\t});\r\n\r\n This source code call the `show` method of the `journalchooser` library. This method take two parameters:\r\n \r\n * the first one is the callback called when the user click on the moment. For the moment, we're leave it empty\r\n * the second one is a list of filters to identify what type of Journal entries you're looking for. Here we're looking for images, so we set `mimetype` equal to `image/png` or `image/jpeg`. But it's possible too to ask for items from a specific activity by using something like `{ activity: 'org.sugarlabs.Pawn'}`.\r\n\r\nLet's run again the activity. Now, when you click on the new toolbar button the Journal chooser is displayed and the list contains our Moon image.\r\n\r\n![](images/tutorial_step7_7.png)\r\n\r\nBy the way nothing happens when the item is clicked.\r\n\r\n\r\n\r\n### A nice background\r\n\r\nWe're going to start by importing a nice checkboard image. You could download it [here](images/checkboard.png). Right-click on it and then save it on your desktop. It looks like that:\r\n\r\n![](images/checkboard.png)\r\n\r\nBy combining it multiple times it will become a very nice checkboard.\r\n\r\nLet's import first this image into the Journal. To do that, go to the Journal view and click on the **Copy from device** button. Select the `checkboard.png` file then click Open button. \r\n\r\n![](images/tutorial_step7_8.png)\r\n\r\nThe file is now into the Journal.\r\n\r\n![](images/tutorial_step7_9.png)\r\n\r\nWe will now ready to add the source code to change the background. Here's the new way to call the `journalchooser.show` method:\r\n\r\n\t\t\tjournalchooser.show(function (entry) {\r\n\t\t\t\t// No selection\r\n\t\t\t\tif (!entry) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// Get object content\r\n\t\t\t\tvar dataentry = new datastore.DatastoreObject(entry.objectId);\r\n\t\t\t\tdataentry.loadAsText(function (err, metadata, data) {\r\n\t\t\t\t\tdocument.getElementById(\"canvas\").style.backgroundImage = \"url('\"+data+\"')\";\r\n\t\t\t\t});\r\n\t\t\t}, { mimetype: 'image/png' }, { mimetype: 'image/jpeg' });\r\n\r\nWhen the callback is called, if the `entry` parameter is `null` it's mean that the dialog box was closed without selection. \r\nElse the `entry` parameter contains metadata for the selected item. So we can create a `DatastoreObject` to handle the object and specifically load its content using the `loadAsText` method. We've already seen this method in [step 4](tutorial_step4.md) but this time it's not to load the Journal item associated with the activity but to load another Journal item.\r\n\r\nThe callback for the `loadAsText` method receive the content of the item into the `data` parameter. In the case of an image, it's a base64 encoding of the image. Something like: \r\n\r\n\tdata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAIAAAAiOjnJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wIRCSUFWSm...\r\n\r\nThis format is natively supported in HTML, so we just need to set this value into the `background-image` style of the canvas element and voilà!\r\n\t\t \r\n\t\t document.getElementById(\"canvas\").style.backgroundImage = \"url('\"+data+\"')\";\r\n\r\nI'm sure you can't wait to test it. Relaunch the Pawn activity, click on the button to show the dialog then click on the checkboard.png image. Here what happens:\r\n\r\n![](images/tutorial_step7_10.png)\r\n\r\nWaooow, a very beautiful background for our pawns!\r\n\r\nYou've learned in this step how to integrate content from the Journal using the Journal chooser dialog. It's a nice way to allow learners to combine multiple activities and create powerful contents.\r\n\r\n\r\nNote that the background chosen should be stored in the datastore object for the activity else it will be lost on the next launch. It should be interesting also to send it to other connected users. You could try to solve these issues as an exercise.\r\n\r\n\r\n[Go to next step](tutorial_step8.md)"},"3f8c5":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nIn the previous step, we\'ve started to see how to use the unique Sugar UI. Let\'s see now another major feature of Sugar, the Journal, and how to handle it from our activity.\r\n\r\n# What is the Journal?\r\n\r\nLaunch the Paint activity from the Sugarizer home view.\r\n\r\n![](images/tutorial_step4_1.png)\r\n\r\nDraw something.\r\n\r\n![](images/tutorial_step4_2.png)\r\n\r\nThen stop the activity by clicking on the Stop button to the right.\r\n\r\nRelaunch it. You will retrieve the same drawing. That what the Journal is for: take care of your work without need to save it. Stop the activity again and go to the home view. Now just let the mouse on the Paint icon without clicking on it. A popup will appear after one second.\r\n\r\n![](images/tutorial_step4_3.png)\r\n\r\nClick on the **Start new** item.\r\n\r\nThis time a new drawing is created. Draw something else and click on the Paint icon to access the activity menu. Change the text to "*My second drawing*".\r\n\r\n\r\n![](images/tutorial_step4_4.png)\r\n\r\nStop the activity to go back to the Sugarizer home view. Then click on the Journal icon under the XO buddy icon.\r\n\r\n![](images/tutorial_step4_5.png)\r\n\r\nIt will display the Journal view. You will see here all your past work: the initial drawing and the second drawing that you\'ve renamed. Just click on one of these lines to relaunch the activity in the exact state where you leave it. That\'s why the Journal is so useful.\r\n\r\n![](images/tutorial_step4_6.png)\r\n\r\nNote that in the Journal you will see also your new Pawn activity. Let\'s see how we could handle context saving in this activity like Paint activity.\r\n\r\n# Identify the context\r\n\r\nThe "context" for our Pawn activity is the current number of pawns on the board. So a user could expect to retrieve the same number of pawns when he reopens the activity.\r\n\r\nThe array `pawns` contain all pawns. It\'s the context for our activity.\r\n\r\n# Store context in the datastore\r\n\r\nTo store the context, we have to handle the **datastore**. The datastore is the place where Sugar stores the Journal. During the activity setup, Sugar-Web automatically initializes the datastore for the activity. \r\n\r\nFirst include the `SugarJournal` component in your activity and instantiate it inside the app element.\r\n```html\r\n    ...\r\n    <sugar-activity ref="SugarActivity" v-on:loaded="initializeActivity"></sugar-activity>\r\n    <sugar-journal ref="SugarJournal"></sugar-journal>\r\n  </div>\r\n\r\n  <script src="js/Pawn.js"><\/script>\r\n  <script src="js/components/SugarActivity.js"><\/script>\r\n  <script src="js/components/SugarToolbar.js"><\/script>\r\n  <script src="js/components/SugarJournal.js"><\/script>\r\n  <script src="js/activity.js"><\/script>\r\n</body>\r\n```\r\n\r\nThe `ref` property is very important for the Vue.js components, it is how we will access the component throughtout the Vue instance. It is also important to follow the naming convention for `ref`, it should be the same as the name of the component file (`js/components/{FileName}.js` => `ref="FileName"`) for Sugar components.\r\n\r\nThe `saveData()` method allows you to store a JavaScript object into the datastore which can be retrieved later. The data is converted to JSON automatically and stored as a text string.\r\n\r\nThe `SugarJournal` component automatically retrieves the data inside Journal (if any) for the current activity and emits an event `journal-data-loaded`. You are free to handle this event whichever way you like. The data is parsed from the JSON format and returned as a JavaScript object.\r\n\r\nSo below is the source code to store the context in the datastore.\r\n\r\nFirst, convert the **pawns** array as JSON string and store it in the current object.\r\n```js\r\nvar context = {\r\n  pawns: this.pawns\r\n};\r\nthis.$refs.SugarJournal.saveData(context);\r\n```\r\n\r\nThis whole code should be called at the end of the activity. To do that we have to catch the click on the Stop button of the activity. So let\'s create another method in `js/activity.js` to call when stopping the activity.\r\n```js\r\nonStop: function () {\r\n  // Save current pawns in Journal on Stop\r\n  var context = {\r\n    pawns: this.pawns\r\n  };\r\n  this.$refs.SugarJournal.saveData(context);\r\n}\r\n```\r\n\r\nThen add the event listener to the stop-button in `index.html`:\r\n```html\r\n<sugar-toolitem id="stop-button" title="Stop" class="pull-right" v-on:click="onStop"></sugar-toolitem>\r\n```\r\n\r\nIt\'s the first step: the board is now safely saved in the datastore.\r\n\r\nLet\'s know how we could retrieve it.\r\n\r\n# Detect the need to load the context\r\n\r\nOur Pawn activity works well when it\'s called from the **Start new** menu, i.e. with a new instance. Because in that case, we don\'t have to reload the context.\r\nSo the first question to ask is: how to detect that we need to load the context?\r\n\r\nOnce again, the Sugar-Web environment could help us. When an activity is launched from an existing context, the environment contains an `objectId` property with the identifier for the datastore object. When an activity is launch with a new instance, this property is null.\r\n\r\nThe good part is, `SugarJournal` handles this for you! Let\'s display the JavaScript console on your browser and test it. Launch the Pawn activity from the **Start new** menu or from List view of activities. Here is the result:\r\n\r\n![](images/tutorial_step4_7.png)\r\n\r\nNow open the Pawn activity from the Journal or by clicking on the Pawn icon on the Home view. Here is the result:\r\n\r\n\r\n![](images/tutorial_step4_8.png)\r\n\r\nOf course, the context is not loaded for the moment in the activity but at least we\'ve got a way to detect when it should be loaded and when it shouldn’t be loaded.\r\n\r\n# Load context from the datastore\r\n\r\nWhen our activity is launched with an existing instance, `SugarJournal` will emit an event `journal-data-loaded` with the loaded parsed data when the activity starts. We can handle this by creating a method:\r\n```js\r\nonJournalDataLoaded: function(data, metadata) {\r\n  this.pawns = data.pawns;\r\n},\r\n```\r\nWe get the pawns array from the context we stored in the Journal and we set the `pawns` data property to it.\r\n\r\nLet\'s attach this method to the event emitted from the Journal:\r\n```html\r\n<sugar-journal ref="SugarJournal" v-on:journal-data-loaded="onJournalDataLoaded"></sugar-journal>\r\n```\r\n\r\nLet\'s try if it works.\r\n\r\nLaunch the Pawn activity from the **Start new** menu. Here is the result:\r\n\r\n![](images/tutorial_step4_9.png)\r\n\r\nThe activity displays a blank board as expected.\r\n\r\nClick a few times on the Plus button to add some pawns and stop the activity. Now re-open the activity by clicking on the Pawn icon on the Home view (Or Journal view). Here is the result:\r\n\r\n![](images/tutorial_step4_10.png)\r\n\r\nYes! It\'s what we expected too: the activity reopens with the right number of pawns.\r\n\r\nThe Journal is now fully supported by the Pawn activity.'},"4dc6":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 15mn)*\r\n\r\nYour current Sugarizer session talks probably the same language as you. At the first setup, Sugarizer detects the language of your browser and uses this language for the UI and the activities\r\n\r\nYou could also change the language from the settings. Hover the mouse on the XO buddy icon on the Sugarizer home view and then click on settings, then to "Language" to display the language settings window.\r\n\r\n\r\n![](images/tutorial_step5_1.png)\r\n\r\nIf you choose another language, this new language will be used for all activities. Let\'s see how we could use it in our Pawn activity too.\r\n\r\n# Identify strings to localize\r\n\r\nSugarizer and Sugar-Web use the [webL10n](https://github.com/fabi1cazenave/webL10n) JavaScript library to handle localization.\r\n\r\nThe first step when you localize an activity is to identify strings to localize. It means replace hard-coded string in your HTML or JavaScript files by localization resources. In the Pawn activity we\'ve got three strings to localize:\r\n\r\n* *"Hello {user}"*: the welcome message\r\n* *"{user} played!"*: when the user played a pawn\r\n* *"Add pawn"*: the helper message on the toolbar button\r\n\r\nWith the webL10n library, all strings have to be defined in a specific file where all translations for each string should be set. We call this file `locale.ini`.  So using your text editor, let\'s create a `locale.ini` file at the root of the Pawn activity. Here what it looks likes: \r\n```ini\r\n[*]\r\nHello=Hello {{name}}!\r\nPlayed={{name}} played\r\nAddPawn=Add pawn\r\n\r\n[en]\r\nHello=Hello {{name}}!\r\nPlayed={{name}} played\r\nAddPawn=Add pawn\r\n\r\n[fr]\r\nHello=Bonjour {{name}} !\r\nPlayed={{name}} a joué\r\nAddPawn=Ajouter pion\r\n\r\n[es]\r\nHello=Hola {{name}} !\r\nPlayed={{name}} jugó\r\nAddPawn=Agrega un peón\r\n```\r\n\r\nThis file is decomposed into sections. One section for each language with the language code between brackets as section name (**en**, **fr**, **es**, ...) and a special section (**\\***) for unknown language.\r\n\r\nIn each section, you have to define translations for each string. The left side of the equal sign is the id of the string (**Hello**, **Played**, **AddPawn**), the right side of the equal sign is the translated string.\r\n\r\nFor parameterized strings (i.e. strings where a value is inside the string), the double curved bracket **\\{\\{\\}\\}** notation is used.\r\n\r\nNow we will integrate our new `locale.ini` file into `index.html`:\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n\r\n<head>\r\n<meta charset="utf-8" />\r\n<title>Pawn Activity</title>\r\n<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover"/>\r\n\r\n\x3c!-- Add locale.ini file --\x3e\r\n<link rel="prefetch" type="application/l10n" href="locale.ini">\r\n\r\n<link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\r\n\thref="lib/sugar-web/graphics/css/sugar-96dpi.css">\r\n...\r\n</html>\r\n```\r\n\r\nThe file is included as a HTML `link` tag and must have a `application/l10n` type to be recognized by webL10n library.\r\n\r\n# Initialize localization\r\n\r\nWe will now see how to initialize localization into the activity source code.\r\n\r\nOnce again we will first have to integrate a new dependance. So let\'s add the webL10n library in the first line of `js/activity.js`:\r\n```js\r\ndefine(["sugar-web/activity/activity", "sugar-web/env", "sugar-web/graphics/icon", "webL10n"], function (activity, env, icon, webL10n) {\r\n```\r\n\r\nThe webL10n library is able to automatically detect the browser language. But in Sugarizer it\'s different because the language is decided by the user. So our activity have to initialize current language using the user choice. Once again we\'re going to use the environment feature to determine the user language. Our current `getEnvironment` call in `js/activity.js` file is like this:\r\n```js\r\nenv.getEnvironment(function(err, environment) {\r\n\tcurrentenv = environment;\r\n\r\n\t// Load from datatore\r\n\tif (!environment.objectId) {\r\n\t\tconsole.log("New instance");\r\n\t} else {\r\n\t\tactivity.getDatastoreObject().loadAsText(function(error, metadata, data) {\r\n\t\t\tif (error==null && data!=null) {\r\n\t\t\t\tpawns= JSON.parse(data);\r\n\t\t\t\tdrawPawns();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n```\r\nLet\'s update it like this to set the language:\r\n```js\r\nenv.getEnvironment(function(err, environment) {\r\n\tcurrentenv = environment;\r\n\r\n\t// Set current language to Sugarizer\r\n\tvar defaultLanguage = (typeof chrome != \'undefined\' && chrome.app && chrome.app.runtime) ? chrome.i18n.getUILanguage() : navigator.language;\r\n\tvar language = environment.user ? environment.user.language : defaultLanguage;\r\n\twebL10n.language.code = language;\r\n\r\n\t// Load from datatore\r\n\tif (!environment.objectId) {\r\n\t\tconsole.log("New instance");\r\n\t} else {\r\n\t\tactivity.getDatastoreObject().loadAsText(function(error, metadata, data) {\r\n\t\t\tif (error==null && data!=null) {\r\n\t\t\t\tpawns = JSON.parse(data);\r\n\t\t\t\tdrawPawns();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n```\r\nWe\'re doing three things:\r\n\r\n* Determine the `defaultLanguage` for the browser: it\'s in the `navigator.language` variable except for Chrome OS where you have to get it using a `chrome.i18n.getUILanguage()` call\r\n* Get the user language: it\'s in `environment.user.language` except if it\'s not set. In that case, we\'re using the `defaultLanguage`\r\n* Force the language for webL10n library: you just have to set the value for `webL10n.language.code`.\r\n\r\nThat\'s all. The right language is now set into webL10n at startup.\r\n\r\n\r\n# Set strings value depending on the language\r\n\r\nTo get the localized version of a string, the webL10n framework provide a simple `get` method. You pass to the method the id of the string (the left side of the plus sign in the INI file) and, if need, the string parameter. So for the welcome message, here is the line to write:\r\n```js\r\ndocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Hello", {name:currentenv.user.name})+"</h1>";\r\n```\r\nAs you could see the first `get` parameter is the id of the string (**Hello**) and the second parameter is a JavaScript object where each property is the name of the parameter (the one provided inside double curved brackets **\\{\\{\\}\\}**, **name** here). The result of the function is the string localized in the current language set in webL10n.\r\n\r\nIn a same way, the pawn played message could be rewrite as: \r\n```js\r\ndocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Played", {name:currentenv.user.name})+"</h1>";\r\n```\r\nOne point however: we need to wait to initialize strings that the `locale.ini` is read. It\'s possible because the webL10n framework raises a new `localized` event on the window when the language is ready.\r\n\r\nSo we will now initialize the welcome message in the `localized` event listener like that, in the end of the require function of `js/activity.js` file:\r\n```js\r\n// Process localize event\r\nwindow.addEventListener("localized", function() {\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Hello", {name:currentenv.user.name})+"</h1>";\r\n\tdocument.getElementById("add-button").title = webL10n.get("AddPawn");\r\n});\r\n```\r\nEverything is now ready to handle localization.\r\n\r\nLet\'s test it. Change the Sugarizer language to French and let\'s see the result.\r\n\r\n\r\n![](images/tutorial_step5_2.png)\r\n\r\nThe welcome message and the button placeholder is now in French. The played message works too.'},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("h1",{staticClass:"heading"},[t._v("Sugarizer Dynamic Tutorial")]),n("LanguageSelector",{attrs:{languages:t.languages,selected:t.selectedLanguage},on:{languageSelected:t.switchLanguage}}),n("StepSelector",{attrs:{stepNumbers:t.stepNumbers,selected:t.selectedStep},on:{stepSelected:t.switchStep}}),n("Step",{attrs:{step:t.stepToShow,selectedStep:t.selectedStep,language:t.selectedLanguage}}),n("StepSelector",{attrs:{stepNumbers:t.stepNumbers,selected:t.selectedStep},on:{stepSelected:t.switchStep}})],1)},a=[],o=(n("b64b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v(t._s(t.step.title))]),n("Content",{key:t.language+t.selectedStep,attrs:{file:t.step.file,language:t.language}})],1)}),s=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"content"},[n("div",{domProps:{innerHTML:t._s(t.html)}})])},c=[],h=(n("99af"),n("e0c1")),d=n.n(h),u=n("1487"),p=n.n(u),g=(n("7437"),{data:function(){return{html:""}},props:{file:String,language:String},mounted:function(){var t=this,e=new d.a.Renderer;e.code=function(e,n){return'<pre><code class="hljs '.concat(n||"",'">').concat(t.doRenderCode(e,n),"</code></pre>")},d.a.setOptions({renderer:e,pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1}),this.parseContent()},methods:{doRenderCode:function(t,e){return e?p.a.highlight(e,t,!0).value:p.a.highlightAuto(t).value},parseContent:function(){var t=n("1771")("./".concat(this.language,"/").concat(this.file));this.html=d()(t.default)}}}),w=g,m=(n("b318"),n("2877")),v=Object(m["a"])(w,l,c,!1,null,null,null),y=v.exports,f={components:{Content:y},props:{step:Object,selectedStep:String,language:String}},b=f,k=Object(m["a"])(b,o,s,!1,null,null,null),S=k.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("form",{staticClass:"language-selection"},t._l(t.languages,(function(e){return n("div",{key:e,staticClass:"form-field"},[n("input",{attrs:{type:"radio",name:"language"},domProps:{value:e,checked:t.selected==e},on:{input:function(n){return t.$emit("languageSelected",e)}}}),n("label",{attrs:{for:e}},[t._v(t._s(e))])])})),0)])},T=[],j={props:["languages","selected"]},z=j,I=(n("70ab"),Object(m["a"])(z,x,T,!1,null,"29de13ca",null)),_=I.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"step-selection"},t._l(t.stepNumbers,(function(e){return n("button",{key:e,staticClass:"btn-step",class:{selected:t.selected==e},on:{click:function(n){return t.$emit("stepSelected",e)}}},[t._v(t._s(e))])})),0)},P=[],A={props:["stepNumbers","selected"]},E=A,C=(n("2b8c"),Object(m["a"])(E,L,P,!1,null,"b81d7f08",null)),W=C.exports,J=n("0873"),H={name:"App",components:{Step:S,LanguageSelector:_,StepSelector:W},data:function(){return{tutorial:null,languages:["VanillaJS","VueJS"],selectedLanguage:"VanillaJS",selectedStep:"0"}},computed:{stepNumbers:function(){return Object.keys(this.tutorial.steps)},stepToShow:function(){return this.tutorial.steps[this.selectedStep]}},created:function(){this.tutorial=J},methods:{switchLanguage:function(t){this.selectedLanguage=t},switchStep:function(t){this.selectedStep=t}}},N=H,M=(n("034f"),Object(m["a"])(N,i,a,!1,null,null,null)),O=M.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(O)}}).$mount("#app")},"60e8":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 15mn)*\r\n\r\nYour current Sugarizer session talks probably the same language as you. At the first setup, Sugarizer detects the language of your browser and uses this language for the UI and the activities\r\n\r\nYou could also change the language from the settings. Hover the mouse on the XO buddy icon on the Sugarizer home view and then click on settings, then to "Language" to display the language settings window.\r\n\r\n\r\n![](images/tutorial_step5_1.png)\r\n\r\nIf you choose another language, this new language will be used for all activities. Let\'s see how we could use it in our Pawn activity too.\r\n\r\n# Identify strings to localize\r\n\r\nSugarizer and Sugar-Web use the [webL10n](https://github.com/fabi1cazenave/webL10n) JavaScript library to handle localization.\r\n\r\nThe first step when you localize an activity is to identify strings to localize. It means replace hard-coded string in your HTML or JavaScript files by localization resources. In the Pawn activity we\'ve got three strings to localize:\r\n\r\n* *"Hello {user}"*: the welcome message\r\n* *"{user} played!"*: when the user played a pawn\r\n* *"Add pawn"*: the helper message on the toolbar button\r\n\r\nWith the webL10n library, all strings have to be defined in a specific file where all translations for each string should be set. We call this file `locale.ini`.  So using your text editor, let\'s create a `locale.ini` file at the root of the Pawn activity. Here what it looks likes: \r\n```ini\r\n[*]\r\nHello=Hello {{name}}!\r\nPlayed={{name}} played\r\nAddPawn=Add pawn\r\n\r\n[en]\r\nHello=Hello {{name}}!\r\nPlayed={{name}} played\r\nAddPawn=Add pawn\r\n\r\n[fr]\r\nHello=Bonjour {{name}} !\r\nPlayed={{name}} a joué\r\nAddPawn=Ajouter pion\r\n\r\n[es]\r\nHello=Hola {{name}} !\r\nPlayed={{name}} jugó\r\nAddPawn=Agrega un peón\r\n```\r\n\r\nThis file is decomposed into sections. One section for each language with the language code between brackets as section name (**en**, **fr**, **es**, ...) and a special section (**\\***) for unknown language.\r\n\r\nIn each section, you have to define translations for each string. The left side of the equal sign is the id of the string (**Hello**, **Played**, **AddPawn**), the right side of the equal sign is the translated string.\r\n\r\nFor parameterized strings (i.e. strings where a value is inside the string), the double curved bracket **\\{\\{\\}\\}** notation is used.\r\n\r\nNow we will integrate our new `locale.ini` file into `index.html`:\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n\r\n<head>\r\n\t<meta charset="utf-8" />\r\n\t<title>Pawn Activity</title>\r\n\t<meta name="viewport"\r\n\t\tcontent="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover" />\r\n\r\n  \x3c!-- Add locale.ini file --\x3e\r\n  <link rel="prefetch" type="application/l10n" href="locale.ini">\r\n\r\n\t<link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\r\n\t\thref="lib/sugar-web/graphics/css/sugar-96dpi.css">\r\n\t...\r\n```\r\n\r\nThe file is included as a HTML `link` tag and must have a `application/l10n` type to be recognized by webL10n library.\r\n\r\n# Initialize localization\r\n\r\nWe will now see how to initialize localization into the activity source code.\r\n\r\nOnce again we will have first to integrate a new component. So let\'s add the `SugarL10n` to `index.html` and create an instance:\r\n```html\r\n    ...\r\n    <sugar-journal ref="SugarJournal" v-on:journal-data-loaded="onJournalDataLoaded"></sugar-journal>\r\n    <sugar-localization ref="SugarLocalization"></sugar-localization>\r\n  </div>\r\n\r\n  <script src="js/Pawn.js"><\/script>\r\n  <script src="js/components/SugarActivity.js"><\/script>\r\n  <script src="js/components/SugarToolbar.js"><\/script>\r\n  <script src="js/components/SugarJournal.js"><\/script>\r\n  <script src="js/components/SugarL10n.js"><\/script>\r\n  <script src="js/activity.js"><\/script>\r\n</body>\r\n```\r\n\r\nNow in `js/activity.js`, let\'s keep a data variable as a reference to this component instance as it might be used multiple times in the activity.\r\n```js\r\ndata: {\r\n  currentenv: null,\r\n  SugarLocalization: null,\r\n  ...\r\n},\r\nmounted: function () {\r\n  this.SugarLocalization = this.$refs.SugarLocalization;\r\n},\r\n```\r\n\r\nThe `SugarL10n` component automatically detects the language set by the user using the environment and configures the webL10n library accordingly.\r\n\r\n# Set strings value depending on the language\r\n\r\nTo get the localized version of a string, the webL10n framework provide a simple `get` method. You pass to the method the id of the string (the left side of the plus sign in the INI file) and, if need, the string parameter. You can call the `get` method of the Sugar component which will work the same way. The `SugarL10n` also provides a `localize(object)` method to localize a JavaScript object containing string id\'s. \r\n\r\nSo for the welcome message, here is the line to write:\r\n```js\r\nthis.displayText = this.SugarLocalization.get("Hello", { name: this.currentenv.user.name });\r\n```\r\nAs you could see the first `get` parameter is the id of the string (**Hello**) and the second parameter is a JavaScript object where each property is the name of the parameter (the one provided inside double curved brackets **\\{\\{\\}\\}**, **name** here). The result of the function is the string localized in the current language set in webL10n.\r\n\r\nIn a same way, the pawn played message could be rewrite as: \r\n```js\r\nthis.displayText = this.SugarLocalization.get("Played", { name: this.currentenv.user.name });\r\n```\r\n\r\nTo set localized titles to toolbar items, let\'s define a JavaScript object `l10n` which will store string id\'s of the strings we want (strings here should be static, i.e. without parameters)\r\n```js\r\ndata: {\r\n  ...\r\n  l10n: {\r\n    stringAddPawn: \'\'\r\n  }\r\n}\r\n```\r\n**NOTE:** *The string id\'s inside the object should be prefixed by the word "string". For example in this case we want the string for `AddPawn`, so in the object we will write `stringAddPawn: \'\'`.*\r\n\r\nWe can localize this object by calling the `localize` method: \r\n```js\r\nthis.SugarLocalization.localize(this.l10n);\r\n```\r\n\r\nLet\'s bind this to the title of add-button:\r\n```html\r\n<sugar-toolitem id="add-button" v-bind:title="l10n.stringAddPawn" v-on:click="onAddClick"></sugar-toolitem>\r\n```\r\n\r\nOne point however: we need to wait to initialize strings that the `locale.ini` is read. It\'s possible because the webL10n framework raises a new `localized` event on the window when the language is ready. Our `SugarL10n` component will emit a Vue event called `localized` as well.\r\n\r\nSo we will now initialize the welcome message in the `localized` event listener, which we add in `js/activity.js` file:\r\n```js\r\ninitializeActivity: function () {\r\n  // Initialize Sugarizer\r\n  this.$refs.SugarActivity.setup();\r\n  this.currentenv = this.$refs.SugarActivity.getEnvironment();\r\n\r\n  /*Set the event listener here */\r\n  this.SugarLocalization.$on(\'localized\', this.localized());\r\n},\r\n\r\n// Handles localized event\r\nlocalized: function () {\r\n  this.displayText = this.SugarLocalization.get("Hello", { name: this.currentenv.user.name });\r\n  this.SugarLocalization.localize(this.l10n);\r\n},\r\n```\r\n**NOTE:** *We define the event listener using `$on` in `initializeActivity()` rather than as a `v-on` directive on the `<sugar-localized>` tag to maintain the flow of the activity. Defining the event listener as a directive might cause the `localized()` method to be called BEFORE the `currentenv` is set. This will lead to undesired results.*\r\n\r\nEverything is now ready to handle localization.\r\n\r\nLet\'s test it. Change the Sugarizer language to French and let\'s see the result.\r\n\r\n\r\n![](images/tutorial_step5_2.png)\r\n\r\nThe welcome message and the button placeholder is now in French. The played message works too.'},"639c":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nLet\'s now improve our activity to customize the content.\r\n\r\n# Customize the icon\r\n\r\nThe first task is to customize the icon. It\'s important because it\'s the visual identity of your activity.\r\n\r\nFor our new activity, we\'ll take a Pawn icon inspired by Andrejs Kirma from The Noun Project. You could download this file [here](images/pawn-icon.svg). Right-click on it and then save it in a `pawn-icon.svg` file into a new `Pawn.activity/icons` directory.\r\n\r\n![](images/tutorial_step2_1.png)\r\n\r\nIn Sugarizer, images for icons or buttons must be SVG graphic files. It needs to be adapted to support users\' colors because as you could see on the home page, all icons in Sugarizer are dynamically adapted to users\' colors.\r\n\r\nTo do that, we need to update our original SVG file.\r\nHere\'s an extract on our original `icons/pawn-icon.svg` file:\r\n```xml\r\n<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n<svg\r\n\txmlns:dc="http://purl.org/dc/elements/1.1/"\r\n\txmlns:cc="http://creativecommons.org/ns#"\r\n\txmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n\txmlns:svg="http://www.w3.org/2000/svg"\r\n\txmlns="http://www.w3.org/2000/svg"\r\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/ sodipodi-0.dtd"\r\n\txmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n\twidth="55pt"\r\n\theight="55pt"\r\n\tversion="1.1"\r\n\tviewBox="0 0 55 55"\r\n\tid="svg2"\r\n\tinkscape:version="0.91 r13725"\r\n\tsodipodi:docname="pawn-icon.svg">\r\n\t\t...\r\n\t<g\r\n\t\tid="g4"\r\n\t\tstyle="fill:#808080;fill-rule:evenodd" transform="matrix(0.39971901,0,0,0.39971901,6.4164118,6.3421946)">\r\n\t\t<path\r\n\t\t\tstyle="fill:#808080"\r\n\t\t\td="M 69.117,19.117 C 69.419097,8.5405271 59.563829,-0.82065091 49.016209,0.02487387 38.442487,0.26964532 29.602814,10.583179 30.981695,21.071762 31.767586,31.615772 42.507095,39.916726 52.911417,38.013738 62.017401,36.775538 69.289121,28.312864 69.117,19.117 Z m -32.352,0 C 36.487927,11.039319 44.80784,4.2563204 52.665901,6.151898 60.600506,7.5124622 65.573683,16.956696 62.192903,24.268128 59.309957,31.766263 49.109454,34.806773 42.600068,30.090646 38.995267,27.691276 36.726564,23.451719 36.765,19.117 Z"\r\n\t\t\tid="path6"\r\n\t\t\tinkscape:connector-curvature="0" />\r\n\t\t...\r\n\t\t</g>\r\n\t<g\r\n\t\tid="g4230"\r\n\t\tstyle="fill:#f0f0f0;stroke:#f0f0f0"\r\n\t\ttransform="matrix(0.39971901,0,0,0.39971901,6.9463181,6.2146783)">\r\n\t\t...\r\n\t</g>\r\n</svg>\r\n```\r\nTo adapt this SVG file to Sugarizer, we will update the start of the file to add ENTITY variables named **stroke_color** and **fill_color**.\r\n\r\nThen we will replace raw colors value `#xxxxxx` in the SVG file, by reference to `&fill_color;` and `&stroke_color;`.\r\n\r\nHere, using your text editor you must replace all `#808080` by `&fill_color;` and all `#f0f0f0` by `&stroke_color;`.\r\n\r\nHere is an extract of the result:\r\n```xml\r\n<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n<!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [\r\n\t<!ENTITY stroke_color "#010101">\r\n\t<!ENTITY fill_color "#FFFFFF">\r\n]>\r\n<svg\r\n\txmlns:dc="http://purl.org/dc/elements/1.1/"\r\n\txmlns:cc="http://creativecommons.org/ns#"\r\n\txmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n\txmlns:svg="http://www.w3.org/2000/svg"\r\n\txmlns="http://www.w3.org/2000/svg"\r\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/ sodipodi-0.dtd"\r\n\txmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n\twidth="55pt"\r\n\theight="55pt"\r\n\tversion="1.1"\r\n\tviewBox="0 0 55 55"\r\n\tid="svg2"\r\n\tinkscape:version="0.91 r13725"\r\n\tsodipodi:docname="pawn-icon.svg">\r\n\t...\r\n\t<g\r\n\t\tid="g4"\r\n\t\tstyle="fill:&fill_color;;fill-rule:evenodd" transform="matrix(0.39971901,0,0,0.39971901,6.4164118,6.3421946)">\r\n\t\t<path\r\n\t\t\tstyle="fill:&fill_color;"\r\n\t\t\td="M 69.117,19.117 C 69.419097,8.5405271 59.563829,-0.82065091 49.016209,0.02487387 38.442487,0.26964532 29.602814,10.583179 30.981695,21.071762 31.767586,31.615772 42.507095,39.916726 52.911417,38.013738 62.017401,36.775538 69.289121,28.312864 69.117,19.117 Z m -32.352,0 C 36.487927,11.039319 44.80784,4.2563204 52.665901,6.151898 60.600506,7.5124622 65.573683,16.956696 62.192903,24.268128 59.309957,31.766263 49.109454,34.806773 42.600068,30.090646 38.995267,27.691276 36.726564,23.451719 36.765,19.117 Z"\r\n\t\t\tid="path6"\r\n\t\t\tinkscape:connector-curvature="0" />\r\n\t\t...\r\n\t\t</g>\r\n\t<g\r\n\t\tid="g4230"\r\n\t\tstyle="fill:&stroke_color;;stroke:&stroke_color;"\r\n\t\ttransform="matrix(0.39971901,0,0,0.39971901,6.9463181,6.2146783)">\r\n\t\t...\r\n\t</g>\r\n</svg>\r\n```\r\nTo update the activity icon, replace also the content of `activity/activity-icon.svg` by the content of the `pawn-icon.svg` file.\r\n\r\nLet\'s run again our activity. Now, we have a beautiful pawn icon.\r\n\r\n![](images/tutorial_step2_2.png)\r\n\r\n\r\nNote that a Sugar icon set is available in `lib/sugar-web/graphics/icons/`. You could also find more information about how to create icons for Sugar [here](https://wiki.sugarlabs.org/go/Development_Team/Almanac/Making_Icons).\r\n\r\n\r\n# Customize content\r\n\r\nWe will now change the content of our Window. More precisely, we\'re going to replace the **Congratulations** message by a welcome message to the user connected.\r\n\r\nLet\'s first remove the default message, you could find it in `index.html` file:\r\n```html\r\n<h1>Congratulations!</h1>\r\n<p>You are ready to develop this activity. Go ahead and edit the files.<br />\r\nYou can remove this message in the index.html.</p>\r\n```\r\nReplace these few lines by the following:\r\n```html\r\n<div id="user">\r\n\t<h1>{{ displayText }}</h1>\r\n</div>\r\n```\r\nWe\'ll have a `div` and heading inside it to show the welcome message dynamicaaly using a reactive Vue.js data property `displayText`.\r\n\r\nAlso notice the component instance below it. It is handling an event **loaded** using a method `initializeActivity()`.\r\n```html\r\n\t\t...\r\n\t\t<sugar-activity ref="SugarActivity" v-on:loaded="initializeActivity"></sugar-activity>\r\n\t</div>\r\n\r\n\t<script src="js/components/SugarActivity.js"><\/script>\r\n\t<script src="js/components/SugarToolbar.js"><\/script>\r\n\t<script src="js/activity.js"><\/script>\r\n</body>\r\n```\r\n\r\nNow, let\'s study the file `js/activity.js`. It\'s really the heart of your new activity. The current implementation is:\r\n```js\r\n// Rebase require directory\r\nrequirejs.config({\r\n\tbaseUrl: "lib",\r\n\tpaths: {\r\n\t\tactivity: "../js"\r\n\t}\r\n});\r\n\r\n// Vue main app\r\nvar app = new Vue({\r\n\tel: \'#app\',\r\n\tdata: {\r\n\t\tdisplayText: \'\'\r\n\t},\r\n\tmethods: {\r\n\t\tinitializeActivity: function () {\r\n\t\t\t// Initialize Sugarizer\r\n\t\t\tthis.$refs.SugarActivity.setup();\r\n\t\t},\r\n\t}\r\n});\r\n\r\n```\r\nThese lines rely on the framework **require.js** that is used by Sugar-Web to handle JavaScript libraries dependencies. You could read more about the **require.js** framework [here](http://www.requirejs.org/). The first block of code is used to configure `requirejs` baseUrl to be the `lib` directory to load our dependencies and also to add a path to `js` directory. This is followed by a new Vue.js instance with `el: \'#app\'` signifying that the `#app` element is being controlled by Vue.js. Make sure to add all your components/properties inside this element.\r\n\r\nThe method `initializeActivity()` is called automatically when SugarActivity component has loaded. For once let\'s peek into the SugarActivity component to understand what\'s happening behind the scenes.\r\n\r\n> #### Understanding the working\r\n> Open `js/components/SugarActivity.js` and observe the mounted() lifecycle hook. It uses `requirejs` to load the `lib/sugar-web/activity/activity` and `lib/sugar-web/env` and save it as a data property. It also has the method `setup` which calls the setp function for the activity. Refer to requirejs docs to have a better understanding but shortly, there are only two functions to understand: `define` and `require`:\r\n> * `define` is a way to define a new module and express its dependencies.\r\n> * `requirejs` is pretty the same. It tells to **require**: run the following function but before that, load dependencies and give me a reference to it. We have called it in the `mounted()` hook to run it after DOM has loaded.\r\n>\r\n> Once the dependencies have loaded and data values have been set, the `loaded` event is emitted after which the activity can be setup.\r\n\r\nThen comes the most important line of our activity:\r\n```js\r\n// Initialize Sugarizer\r\nthis.$refs.SugarActivity.setup();\r\n```\r\nIt\'s a call to the `setup` method of SugarActivity which inturn is a cal to the `setup` method of the Sugar-Web activity library.\r\n\r\nIf you have to keep only one line in your activity, keep that one because it\'s responsible for all the magic inside Sugarizer: it initializes Datastore, Presence and the Sugarizer UI. A classical error for a beginner in Sugar-Web development is to forget this call. Let\'s do it by commenting the line:\r\n```js\t\r\n// Initialize Sugarizer\r\n//this.$refs.SugarActivity.setup();\r\n```\r\nThen run again your new activity. Here\'s what happens:\r\n\r\n\r\n![](images/tutorial_step2_3.png)\r\n\r\nOoops! Colors for our nice icons have disappeared and when you click on the Stop button nothing happens. Clearly, you\'ve broken the Sugarizer logic :-(\r\n\r\nSo uncomment this precious line and never forget to call it again!\r\n```js\r\n// Initialize Sugarizer\r\nthis.$refs.SugarActivity.setup();\r\n```\r\nNow, to display our welcome message, we will use the user\'s name.\r\n\r\nFirst add a data property `displayText` to the data object.\r\n```js\r\ndata: {\r\n\tdisplayText: \'\'\r\n},\r\n```\r\n\r\nTo get the user\'s name we\'re going to use another Sugar-Web library named **env**. This library contains a very interesting method `getEnvironment`. This method allows you to retrieve all users settings: name, preferred colours, language, favorites, etc.\r\nYou can call this method directly from the SugarActivity component reference. So add a call to this method to retrieve the user name:\r\n```js\r\n// Initialize Sugarizer\r\nthis.$refs.SugarActivity.setup();\r\n\r\nvar environment = this.$refs.SugarActivity.getEnvironment();\r\nthis.displayText = "Hello " + environment.user.name + "!";\r\n});\r\n```\r\nBeing a Vue.js reactive property, `displayText` will automatically be rendered to the screen on update. That\'s all. Run the activity again.\r\n\r\nCongratulations! The welcome message will now appear:\r\n\r\n\r\n![](images/tutorial_step2_4.png)\r\n'},"680e":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 15mn)*\r\n\r\nSugarizer comes with an empty template that you could use as the base of your new activity. So first, copy all content of the Sugarizer `activities/ActivityTemplateVue` directory in a new directory called `activities/Pawn.activity`. **Pawn** will be the name for our new activity.\r\n\r\n\r\n### File structure\r\n\r\nIn your new directory, you will find the following file structure:\r\n\r\n![](images/tutorial_step1_1.png)\r\n\r\n\r\n* `activity/` contains information about your activity, including the name, ID, and the icon.\r\n* `index.html` is where the elements that compose your activity are defined.  The template comes with a toolbar and a canvas where you can place your content.\r\n* `js/activity.js` is where the logic of your activity lives.\r\n* `js/components` contains all Sugar components which can be included and used to have a specific Sugar functionality.\r\n* `css/activity.css` is where you add the styling of your activity.\r\n\r\nThose are the files you\'ll modify in most cases. The others are:\r\n\r\n* `js/loader.js` configures the libraries paths and loads your   `js/activity.js`\r\n* `lib/` contains the libraries\r\n* `package.json` contains information about the libraries the activity depends on\r\n* `setup.py` is used if you want to run your activity in Sugar.\r\n\r\n\r\n### Customize the activity\r\n\r\nThen customize the activity using your text editor. Change the name for your activity. Write `Pawn` in the activity **name** and `org.sugarlabs.Pawn` in **bundle_id** properties in `activity/activity.info` of the new directory.\r\n```\r\n[Activity]\r\nname = Pawn\r\nactivity_version = 1\r\nbundle_id = org.sugarlabs.Pawn\r\nexec = sugar-activity-web\r\nicon = activity-icon\r\n```\r\nUse your text editor to change the **title** tag of `index.html` to `Pawn Activity`.\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n\r\n<head>\r\n\t<meta charset="utf-8" />\r\n\t<title>Pawn Activity</title>\r\n\t<meta name="viewport"\r\n\t\tcontent="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover" />\r\n\t<link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\r\n\t\thref="lib/sugar-web/graphics/css/sugar-96dpi.css">\r\n\t<link rel="stylesheet" media="screen and (device-width: 1200px) and (device-height: 900px)"\r\n\t\thref="lib/sugar-web/graphics/css/sugar-200dpi.css">\r\n\t<link rel="stylesheet" href="css/activity.css">\r\n\t<link rel="stylesheet" href="css/libnotify.css">\r\n\t<script src="lib/vue.min.js"><\/script>\r\n\t<script src="lib/require.js"><\/script>\r\n</head>\r\n...\r\n```\r\n\r\nFinally, update the file `activities.json` at the root of the Sugarizer directory: add a new line for your activity. Update **id**, **name** and **directory** values on this new line to `org.sugarlabs.Pawn`, `Pawn` and `activities/Pawn.activity`.\r\n```json\r\n\t[\r\n\t\t{"id": "org.sugarlabs.Pawn", "name": "Pawn", "version": 1, "directory": "activities/Pawn.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n\t\t{"id": "org.sugarlabs.GearsActivity", "name": "Gears", "version": 6, "directory": "activities/Gears.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n\t\t{"id": "org.sugarlabs.MazeWebActivity", "name": "Maze Web", "version": 2, "directory": "activities/MazeWeb.activity", "icon": "activity/activity-icon.svg", "favorite": true, "activityId": null},\r\n```\r\nNow run Sugarizer, you should see the icon of a new activity like this:\r\n\r\n![](images/tutorial_step1_2.png)\r\n\r\nLet\'s run the activity by clicking on it. You will see the first step of your activity.\r\n\r\n![](images/tutorial_step1_3.png)\r\n\r\nNow you are ready to go ahead and customize your activity.'},"70ab":function(t,e,n){"use strict";var r=n("9d90"),i=n.n(r);i.a},7700:function(t,e,n){"use strict";n.r(e),e["default"]={steps:{0:{},1:{indexTitle:{lang:"html",code:'\n<!DOCTYPE html>\n<html>\n\n<head>\n<meta charset="utf-8" />\n<title>Pawn Activity</title>\n<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"/>\n<link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\n    href="lib/sugar-web/graphics/css/sugar-96dpi.css">\n<link rel="stylesheet" media="screen and (device-width: 1200px) and (device-height: 900px)"\n    href="lib/sugar-web/graphics/css/sugar-200dpi.css">\n<link rel="stylesheet" href="css/activity.css">\n<script data-main="js/loader" src="lib/require.js"><\/script>\n</head>\n...\n        '}}}}},"85ec":function(t,e,n){},"901b":function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nLet\'s now improve our activity to customize the content.\r\n\r\n### Customize the icon\r\n\r\nThe first task is to customize the icon. It\'s important because it\'s the visual identity of your activity.\r\n\r\nFor our new activity, we\'ll take a Pawn icon inspired by Andrejs Kirma from The Noun Project. You could download this file [here](images/pawn-icon.svg). Right-click on it and then save it in a `pawn-icon.svg` file into a new `Pawn.activity/icons` directory.\r\n\r\n![](images/tutorial_step2_1.png)\r\n\r\nIn Sugarizer, images for icons or buttons must be SVG graphic files. It needs to be adapted to support users\' colors because as you could see on the home page, all icons in Sugarizer are dynamically adapted to users\' colors.\r\n\r\nTo do that, we need to update our original SVG file.\r\nHere\'s an extract on our original `icons/pawn-icon.svg` file:\r\n```xml\r\n<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n<svg\r\n\txmlns:dc="http://purl.org/dc/elements/1.1/"\r\n\txmlns:cc="http://creativecommons.org/ns#"\r\n\txmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n\txmlns:svg="http://www.w3.org/2000/svg"\r\n\txmlns="http://www.w3.org/2000/svg"\r\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/ sodipodi-0.dtd"\r\n\txmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n\twidth="55pt"\r\n\theight="55pt"\r\n\tversion="1.1"\r\n\tviewBox="0 0 55 55"\r\n\tid="svg2"\r\n\tinkscape:version="0.91 r13725"\r\n\tsodipodi:docname="pawn-icon.svg">\r\n\t\t...\r\n\t<g\r\n\t\tid="g4"\r\n\t\tstyle="fill:#808080;fill-rule:evenodd" transform="matrix(0.39971901,0,0,0.39971901,6.4164118,6.3421946)">\r\n\t\t<path\r\n\t\t\tstyle="fill:#808080"\r\n\t\t\td="M 69.117,19.117 C 69.419097,8.5405271 59.563829,-0.82065091 49.016209,0.02487387 38.442487,0.26964532 29.602814,10.583179 30.981695,21.071762 31.767586,31.615772 42.507095,39.916726 52.911417,38.013738 62.017401,36.775538 69.289121,28.312864 69.117,19.117 Z m -32.352,0 C 36.487927,11.039319 44.80784,4.2563204 52.665901,6.151898 60.600506,7.5124622 65.573683,16.956696 62.192903,24.268128 59.309957,31.766263 49.109454,34.806773 42.600068,30.090646 38.995267,27.691276 36.726564,23.451719 36.765,19.117 Z"\r\n\t\t\tid="path6"\r\n\t\t\tinkscape:connector-curvature="0" />\r\n\t\t...\r\n\t\t</g>\r\n\t<g\r\n\t\tid="g4230"\r\n\t\tstyle="fill:#f0f0f0;stroke:#f0f0f0"\r\n\t\ttransform="matrix(0.39971901,0,0,0.39971901,6.9463181,6.2146783)">\r\n\t\t...\r\n\t</g>\r\n</svg>\r\n```\r\nTo adapt this SVG file to Sugarizer, we will update the start of the file to add ENTITY variables named **stroke_color** and **fill_color**.\r\n\r\nThen we will replace raw colors value `#xxxxxx` in the SVG file, by reference to `&fill_color;` and `&stroke_color;`.\r\n\r\nHere, using your text editor you must replace all `#808080` by `&fill_color;` and all `#f0f0f0` by `&stroke_color;`.\r\n\r\nHere is an extract of the result:\r\n```xml\r\n<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n<!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [\r\n\t<!ENTITY stroke_color "#010101">\r\n\t<!ENTITY fill_color "#FFFFFF">\r\n]>\r\n<svg\r\n\txmlns:dc="http://purl.org/dc/elements/1.1/"\r\n\txmlns:cc="http://creativecommons.org/ns#"\r\n\txmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n\txmlns:svg="http://www.w3.org/2000/svg"\r\n\txmlns="http://www.w3.org/2000/svg"\r\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/ sodipodi-0.dtd"\r\n\txmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n\twidth="55pt"\r\n\theight="55pt"\r\n\tversion="1.1"\r\n\tviewBox="0 0 55 55"\r\n\tid="svg2"\r\n\tinkscape:version="0.91 r13725"\r\n\tsodipodi:docname="pawn-icon.svg">\r\n\t...\r\n\t<g\r\n\t\tid="g4"\r\n\t\tstyle="fill:&fill_color;;fill-rule:evenodd" transform="matrix(0.39971901,0,0,0.39971901,6.4164118,6.3421946)">\r\n\t\t<path\r\n\t\t\tstyle="fill:&fill_color;"\r\n\t\t\td="M 69.117,19.117 C 69.419097,8.5405271 59.563829,-0.82065091 49.016209,0.02487387 38.442487,0.26964532 29.602814,10.583179 30.981695,21.071762 31.767586,31.615772 42.507095,39.916726 52.911417,38.013738 62.017401,36.775538 69.289121,28.312864 69.117,19.117 Z m -32.352,0 C 36.487927,11.039319 44.80784,4.2563204 52.665901,6.151898 60.600506,7.5124622 65.573683,16.956696 62.192903,24.268128 59.309957,31.766263 49.109454,34.806773 42.600068,30.090646 38.995267,27.691276 36.726564,23.451719 36.765,19.117 Z"\r\n\t\t\tid="path6"\r\n\t\t\tinkscape:connector-curvature="0" />\r\n\t\t...\r\n\t\t</g>\r\n\t<g\r\n\t\tid="g4230"\r\n\t\tstyle="fill:&stroke_color;;stroke:&stroke_color;"\r\n\t\ttransform="matrix(0.39971901,0,0,0.39971901,6.9463181,6.2146783)">\r\n\t\t...\r\n\t</g>\r\n</svg>\r\n```\r\nTo update the activity icon, replace also the content of `activity/activity-icon.svg` by the content of the `pawn-icon.svg` file.\r\n\r\nLet\'s run again our activity. Now, we have a beautiful pawn icon.\r\n\r\n![](images/tutorial_step2_2.png)\r\n\r\n\r\nNote that a Sugar icon set is available in `lib/sugar-web/graphics/icons/`. You could also find more information about how to create icons for Sugar [here](https://wiki.sugarlabs.org/go/Development_Team/Almanac/Making_Icons).\r\n\r\n\r\n### Customize content\r\n\r\nWe will now change the content of our Window. More precisely, we\'re going to replace the **Congratulations** message by a welcome message to the user connected.\r\n\r\nLet\'s first remove the default message, you could find it in `index.html` file:\r\n```html\r\n<h1>Congratulations!</h1>\r\n<p>You are ready to develop this activity. Go ahead and edit the files.<br />\r\nYou can remove this message in the index.html.</p>\r\n```\r\nReplace these few lines by a single line:\r\n```html\r\n<div id="user"></div>\r\n```\r\nWe need only a single `div` because we will generate the welcome message dynamically in JavaScript.\r\n\r\nTo do that, let\'s study the file `js/activity.js`. It\'s really the heart of your new activity. The current implementation is:\r\n```js\r\ndefine(["sugar-web/activity/activity"], function (activity) {\r\n\r\n\t// Manipulate the DOM only when it is ready.\r\n\trequirejs([\'domReady!\'], function (doc) {\r\n\r\n\t\t// Initialize the activity.\r\n\t\tactivity.setup();\r\n\r\n\t});\r\n\r\n});\r\n```\r\nThese lines rely on the framework **require.js** that is used by Sugar-Web to handle JavaScript libraries dependencies. You could read more about the **require.js** framework [here](http://www.requirejs.org/) but shortly, there are only two functions to understand: `define` and `require`.\r\n\r\n* `define` is a way to define a new module and express its dependencies. Here for example we\'re going to define a new module that depends on the JavaScript library `sugar-web/activity/activity`. So when the `js/activity.js` is run, **require** will first load the Sugar-Web activity library and put a reference on it in the `activity` variable.\r\n\r\n* `requirejs` is pretty the same. It tells to **require**: run the following function but before that, load dependencies and give me a reference to it. There is a small hack here because `domReady!` is a special library used to wait for the end of the HTML page loading.\r\n\r\nThen comes the most important line of our activity:\r\n```js\r\n// Initialize the activity.\r\nactivity.setup();\r\n```\r\nIt\'s a call to the `setup` method of the Sugar-Web activity library.\r\n\r\nIf you have to keep only one line in your activity, keep that one because it\'s responsible for all the magic inside Sugarizer: it initializes Datastore, Presence and the Sugarizer UI. A classical error for a beginner in Sugar-Web development is to forget this call. Let\'s do it by commenting the line:\r\n```js\t\r\n// Initialize the activity.\r\n//activity.setup();\r\n```\r\nThen run again your new activity. Here\'s what happens:\r\n\r\n\r\n![](images/tutorial_step2_3.png)\r\n\r\nOoops! Colors for our nice icons have disappeared and when you click on the Stop button nothing happens. Clearly, you\'ve broken the Sugarizer logic :-(\r\n\r\nSo uncomment this precious line and never forget to call it again!\r\n```js\r\n// Initialize the activity.\r\nactivity.setup();\r\n```\r\nNow, to display our welcome message, we will use the user\'s name.\r\n\r\nTo do that we\'re going to use another Sugar-Web library named **env**. So, we need to add it in our dependencies. Update the define call to add the env Sugar-Web library:\r\n```js\r\ndefine(["sugar-web/activity/activity", "sugar-web/env"], function (activity, env) {\r\n```\r\nThis library contains a very interesting method `getEnvironment`. This method allows you to retrieve all users settings: name, preferred colours, language, favorites, ...\r\nSo add a call to this method to retrieve the user name:\r\n```js\r\n// Initialize the activity.\r\nactivity.setup();\r\n\r\n// Welcome user\r\nenv.getEnvironment(function(err, environment) {\r\n\t\tdocument.getElementById("user").innerHTML = "<h1>"+"Hello"+" "+environment.user.name+" !</h1>";\r\n});\r\n```\r\nWhen you call the getEnvironment method, it should load the Sugarizer environment then call your function with a JavaScript object environment that contains context of your activity and user settings. So we could display our welcome message by forcing HTML in the `div` object using `environment.user.name`. Here\'s the line:\r\n```js\r\ndocument.getElementById("user").innerHTML = "<h1>"+"Hello"+" "+environment.user.name+" !</h1>";\r\n```\r\nThat\'s all. Run the activity again.\r\n\r\nCongratulations! The welcome message will now appear:\r\n\r\n\r\n![](images/tutorial_step2_4.png)\r\n'},9690:function(t,e,n){"use strict";n.r(e),e["default"]="*(Estimated time: 15mn)*\r\n\r\nBecause Sugarizer is a platform dedicated to children, activities should be self-understandable. By the way, it's fair to provide some help to shy users that don't want to click everywhere.\r\n\r\nIn this tutorial, you'll learn how to easily integrate a tutorial into your Pawn activity.\r\n\r\n### What's a tutorial in Sugarizer?\r\n\r\nGo to the Sugarizer home view and click on the \"?\" button to launch the tutorial. Use Next/Prev button to navigate.\r\n\r\n![](images/tutorial_step9_1.png)\r\n\r\nAs you can see, the tutorial is a set of dialog box that show you the meaning of UI elements by pointing on them.\r\n\r\nLet's see how to do the same in our Pawn activity.\r\n\r\n\r\n### Prepare the UI\r\n\r\nFirst, we're going to prepare the UI of the activity.\r\n\r\nSugarizer users expect to find the help button into the toolbar. It will be our first step to add it.\r\n\r\n![](images/tutorial_step9_2.png)\r\n\r\nSo, download the help icon `help.svg` [here](images/help.svg) and copy it in the `icons` directory of your Pawn activity.\r\n\r\nThen, as usual, let's add our new button in the toolbar. To do that we will first update the `index.html` by adding the button at the end of the toolbar:\r\n\r\n\t<div id=\"main-toolbar\" class=\"toolbar\">\r\n\r\n     ...\r\n\r\n\t  \x3c!-- Buttons with class=\"pull-right\" will be right aligned --\x3e\r\n\t  <button class=\"toolbutton pull-right\" id=\"stop-button\" title=\"Stop\"></button>\r\n\t  <button class=\"toolbutton pull-right\" id=\"help-button\" title=\"Tutorial\"></button>\r\n\t</div>\r\n\r\nDon't forget the `pull-right` class to align it to the right.\r\n\r\nWe will now associate the icon to this new button. Like in [step 3](tutorial_step3.md) of this tutorial, this association should be done in the `css/activity.css` file. Add these lines at the end of the file.\r\n\r\n\t#main-toolbar #help-button {\r\n      background-image: url(../icons/help.svg);\r\n    }\r\n\r\nLet's run the activity to test the result.\r\n\r\n![](images/tutorial_step9_3.png)\r\n\r\nThe button is here. That's a good start.\r\n\r\n\r\n### Integrate Bootstrap tour components\r\n\r\nSugarizer relys on the [Bootstrap tour library](http://bootstraptour.com/) to produce the UI for the tutorial. \r\n\r\n**Bootstrap tour** is a set of components - based on the famous [Boostrap](https://getbootstrap.com/) and [jQuery](https://jquery.com/) libraries - dedicated to build interactive tutorial. It could be integrated into web pages that already use Bootstrap/jQuery but is also usable standalone for web pages that don't use them (like in our case).\r\n\r\nLet's see how to integrate it in Pawn activity.\r\n\r\nFirst download the bootstrap tour standalone and jQuery JavaScript libraries. You could find the `bootstrap-tour-standalone.min.css` file [here](download/bootstrap-tour-standalone.min.css), the `bootstrap-tour-standalone.min.js` file [here](download/bootstrap-tour-standalone.min.js) and the `jquery.min.js` file [here](download/jquery.min.js).\r\n\r\nCopy these files in your Pawn activity. The first file should be copied in the `css` directory and the two others files should be copied in the `lib` directory.\r\n\r\nWe're now going to reference these files from our `index.html` file. Update the file like that:\r\n\r\n\t...\r\n\t<link rel=\"stylesheet\" href=\"css/activity.css\">\r\n\t\r\n\t<link rel=\"stylesheet\" href=\"css/bootstrap-tour-standalone.min.css\">\r\n\t<script>if (typeof module === 'object') {window.module = module; module = undefined;}<\/script>\r\n\t<script src=\"lib/jquery.min.js\"><\/script>\r\n\t<script src=\"lib/bootstrap-tour-standalone.min.js\"><\/script>\r\n\t<script>if (window.module) module = window.module;<\/script>\r\n\t\r\n\t<script data-main=\"js/loader\" src=\"lib/require.js\"><\/script>\r\n\t...\r\n\r\nThe main change is to add the link on the CSS file and integrate the libraries into the scripts part. \r\n\r\nNote that we've done script integration around `if (typeof module ...)` and `if (window.module)` testing. It's related to an [incompatibility between Electron and jQuery](https://stackoverflow.com/questions/32621988/electron-jquery-is-not-defined). You don't have to worry about that.\r\n\r\n\r\n### Display the tutorial\r\n\r\nOnly a few Javascript lines are needed to display a tutorial with Bootstrap tour. By the way, it's a good practice to separate this specific code in a dedicated file.\r\n\r\nSo, let's create a new Javascript file `lib/tutorial.js` to handle everything related to the tutorial.\r\n\r\nInsert in this file the following code:\r\n\r\n\tdefine([], function () {\r\n\t\tvar tutorial = {};\r\n\t\r\n\t\ttutorial.start = function() {\r\n\t\t\tvar steps = [\r\n\t\t\t\t{\r\n\t\t\t\t\telement: \"\",\r\n\t\t\t\t\torphan: true,\r\n\t\t\t\t\tplacement: \"bottom\",\r\n\t\t\t\t\ttitle: \"Pawn Activity\",\r\n\t\t\t\t\tcontent: \"Welcome into the Pawn activity. This activity is an activity to test Sugarizer development.\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\telement: \"#add-button\",\r\n\t\t\t\t\tplacement: \"bottom\",\r\n\t\t\t\t\ttitle: \"Add pawn\",\r\n\t\t\t\t\tcontent: \"Click here to add one to three pawns on the board.\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\telement: \"#picture-button\",\r\n\t\t\t\t\ttitle: \"Change background\",\r\n\t\t\t\t\tcontent: \"Click here to choose a new background for the board.\"\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\tvar tour = new Tour({steps: steps});\r\n\t\t\ttour.init();\r\n\t\t\ttour.start(true);\r\n\t\r\n\t\t};\r\n\t\r\n\t\treturn tutorial;\r\n\t});\r\n\r\nSince [tutorial step 2](tutorial_step2.md), you should now be familiar with the structure of this file. It defines a new **require.js** component with a single method `start()`.\r\n\r\nThe `start` method contains all the stuff to call Bootstrap tour. \r\n\r\nWe've first defined an array with steps (i.e. dialogs) for the tutorial. Here we've chosen a dialog box to present the activity, then two dialog box to explain the role of \"Add\" and \"Insert Image\" buttons.\r\n\r\nThen we've created the `Tour` object, exposed by the Bootstrap tour library. Finally, we've called the `init()` and `start()` method on this object to display the tutorial.\r\n\r\nReally easy, isn't it?\r\n\r\nCan't wait to test it! \r\n\r\nBut we need first to integrate our new components in the main source code for our Pawn activity. Once again, we will update the dependencies list of libraries at the first line of the `js/activity.js` file.\r\n\r\n\tdefine([\"sugar-web/activity/activity\", ... ,\"pawnpalette\",\"tutorial\"], function (activity, ... , pawnpalette, tutorial) {\r\n\r\nThis time you need to add the `tutorial` library created before. Add the string `\"tutorial\"` at the end of dependencies array and declare a new `tutorial` variable at the end of the function declaration.\r\n\r\nThen we need to add an event listener to handle click on our new help button:\r\n\r\n\t\t// Launch tutorial\r\n\t\tdocument.getElementById(\"help-button\").addEventListener('click', function(e) {\r\n\t\t\ttutorial.start();\r\n\t\t});\r\n\r\nThat's all. Now launch the activity and click on the help button.\r\n\r\n![](images/tutorial_step9_4.png)\r\n\r\nHurrah! It works!\r\n\r\n### Sugarize the UI\r\n\r\nOur tutorial is nice but it don't look like to an usual Sugarizer tutorial. Let's now \"Sugarize\" the tutorial UI.\r\n\r\nA cool feature of Bootstrap tour is that we're able to fully customize the UI by using \"templates\". A template is a way to provide the exact HTML code that you want to use for the tutorial window.\r\n\r\nSo we're going to update the call to Bootstrap tour into `lib/tutorial.js` to include a more Sugarizer friendly UI:\r\n\r\n\t\tvar tour = new Tour({\r\n\t\t\ttemplate: \"\\\r\n\t\t\t<div class='popover tour'>\\\r\n\t\t\t\t<div class='arrow'></div>\\\r\n\t\t\t\t<h3 class='popover-title tutorial-title'></h3>\\\r\n\t\t\t\t<div class='popover-content'></div>\\\r\n\t\t\t\t<div class='popover-navigation' style='display: flex; flex-wrap:wrap; justify-content: center; align-items: center'>\\\r\n\t\t\t\t\t<div class='tutorial-prev-icon icon-button' data-role='prev'>\\\r\n\t\t\t\t\t\t<div class='tutorial-prev-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-prev-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-prev-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>Prev</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<span data-role='separator' style='margin: 4px'>|</span>\\\r\n\t\t\t\t\t<div class='tutorial-next-icon icon-button' data-role='next'>\\\r\n\t\t\t\t\t\t<div class='tutorial-next-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-next-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-next-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>Next</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class='tutorial-end-icon icon-button' data-role='end'>\\\r\n\t\t\t\t\t\t<div class='tutorial-end-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-end-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-end-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>End</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t</div>\",\r\n\t\t\tstorage: false,\r\n\t\t\tbackdrop: true,\r\n\t\t\tsteps: steps\r\n\t\t});\r\n\r\nWe need also to define CSS class used in the template. To do that, add the following lines to the `css/activity.css` file:\r\n\r\n\t.tutorial-title {\r\n\t\tbackground-color: #808080 !important;\r\n\t\tcolor: #ffffff !important;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon {\r\n\t\tdisplay: inline-flex;\r\n\t\twidth: 90px;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon.icon-button {\r\n\t\tcolor: white;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon.icon-button.disabled {\r\n\t\tcolor: black;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon1 {\r\n\t\tmargin-left: 6px;\r\n\t\tmargin-top: 6px;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon2 {\r\n\t\tbackground-image: url(../icons/go-left.svg);\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t}\r\n\t\r\n\t.tutorial-prev-icon3 {\r\n\t\tdisplay: none;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t\tbackground-color: white;\r\n\t\tmargin-top: -20px;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon {\r\n\t\tdisplay: inline-flex;\r\n\t\twidth: 90px;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon.icon-button {\r\n\t\tcolor: white;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon.icon-button.disabled {\r\n\t\tcolor: black;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon1 {\r\n\t\tmargin-left: 6px;\r\n\t\tmargin-top: 6px;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon2 {\r\n\t\tbackground-image: url(../icons/go-right.svg);\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t}\r\n\t\r\n\t.tutorial-next-icon3 {\r\n\t\tdisplay: none;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t\tbackground-color: white;\r\n\t\tmargin-top: -20px;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon {\r\n\t\tdisplay: inline-flex;\r\n\t\twidth: 90px;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon.icon-button {\r\n\t\tcolor: white;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon.icon-button.disabled {\r\n\t\tcolor: black;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon1 {\r\n\t\tmargin-left: 6px;\r\n\t\tmargin-top: 6px;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon2 {\r\n\t\tbackground-image: url(../icons/dialog-cancel.svg);\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t}\r\n\t\r\n\t.tutorial-end-icon3 {\r\n\t\tdisplay: none;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tbackground-size: 20px 20px;\r\n\t\tbackground-color: white;\r\n\t\tmargin-top: -20px;\r\n\t}\r\n\t\r\n\t.icon-tutorial-text {\r\n\t\tmargin-top: 7px;\r\n\t\tpadding-left: 4px;\r\n\t\tpadding-right: 38px;\r\n\t\tdisplay: inline-block;\r\n\t}\r\n\t\r\n\t.web-activity-icon {\r\n\t\tbackground-repeat: no-repeat;\r\n\t\tbackground-position: center;\r\n\t\tpadding: 2px;\r\n\t}\r\n\t\r\n\t.icon-button {\r\n\t\tborder-radius: 22px;\r\n\t\tmargin-top: 5px;\r\n\t\theight: 35px;\r\n\t\tbackground-color: #808080;\r\n\t\tborder: 2px solid #808080;\r\n\t}\r\n\r\nFinally we need to integrate icons used by Sugarizer buttons. So download icons `go-left.svg` [here](images/go-left.svg), `go-right.svg` [here](images/go-right.svg), `dialog-cancel.svg` [here](images/dialog-cancel.svg) and copy them in the `icons` directory.\r\n\r\nLaunch again the activity.\r\n\r\n![](images/tutorial_step9_5.png)\r\n\r\nIt's much better now!\r\n\r\n\r\n### Localize the tutorial\r\n\r\nWe're almost done but we must add a final step to our tutorial. As we've mentioned in [tutorial step 5](tutorial_step5.md), your activity should be localized to automatically adapt to the user language. The same is true for our tutorial.\r\n\r\nSo let's first prepare text to localize. We need to translate title and content for each dialog box and text for buttons. As we've learned during the [tutorial step 5](tutorial_step5.md), update your `locale.ini` file to define new resource strings:\r\n\r\n\tTutoPrev=Prev\r\n\tTutoNext=Next\r\n\tTutoEnd=End\r\n\tTutoExplainTitle=Pawn Activity\r\n\tTutoExplainContent=Welcome into the Pawn activity. This activity is an activity to test Sugarizer development.\r\n\tTutoAddTitle=Add pawn\r\n\tTutoAddContent=Click here to add one to three pawns on the board.\r\n\tTutoBackgroundTitle=Change background\r\n\tTutoBackgroundContent=Click here to choose a new background for the board.\r\n\r\nYou should add these strings in the `*` section and give their translations for `en`, `fr` and `es` sections.\r\n\r\nNow you need to reference the [webL10n](https://github.com/fabi1cazenave/webL10n) JavaScript library into our `lib/tutorial.js`. Update the \"define\" line like this:\r\n\r\n\tdefine([\"webL10n\"], function (l10n) {\r\n\r\nWe're now able to reference our new resource strings by using call to `l10n.get()` method. First into steps:\r\n\r\n\t\tvar steps = [\r\n\t\t\t{\r\n\t\t\t\telement: \"\",\r\n\t\t\t\torphan: true,\r\n\t\t\t\tplacement: \"bottom\",\r\n\t\t\t\ttitle: l10n.get(\"TutoExplainTitle\"),\r\n\t\t\t\tcontent: l10n.get(\"TutoExplainContent\")\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\telement: \"#add-button\",\r\n\t\t\t\tplacement: \"bottom\",\r\n\t\t\t\ttitle: l10n.get(\"TutoAddTitle\"),\r\n\t\t\t\tcontent: l10n.get(\"TutoAddContent\")\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\telement: \"#picture-button\",\r\n\t\t\t\ttitle: l10n.get(\"TutoBackgroundTitle\"),\r\n\t\t\t\tcontent: l10n.get(\"TutoBackgroundContent\")\r\n\t\t\t}\r\n\t\t];\r\n\t\t\r\nThen into the template to change the text for buttons:\r\n\r\n\t\tvar tour = new Tour({\r\n\t\t\ttemplate: \"\\\r\n\t\t\t<div class='popover tour'>\\\r\n\t\t\t\t<div class='arrow'></div>\\\r\n\t\t\t\t<h3 class='popover-title tutorial-title'></h3>\\\r\n\t\t\t\t<div class='popover-content'></div>\\\r\n\t\t\t\t<div class='popover-navigation' style='display: flex; flex-wrap:wrap; justify-content: center; align-items: center'>\\\r\n\t\t\t\t\t<div class='tutorial-prev-icon icon-button' data-role='prev'>\\\r\n\t\t\t\t\t\t<div class='tutorial-prev-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-prev-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-prev-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>\"+l10n.get(\"TutoPrev\")+\"</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<span data-role='separator' style='margin: 4px'>|</span>\\\r\n\t\t\t\t\t<div class='tutorial-next-icon icon-button' data-role='next'>\\\r\n\t\t\t\t\t\t<div class='tutorial-next-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-next-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-next-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>\"+l10n.get(\"TutoNext\")+\"</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class='tutorial-end-icon icon-button' data-role='end'>\\\r\n\t\t\t\t\t\t<div class='tutorial-end-icon1 web-activity'>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-end-icon2 web-activity-icon'></div>\\\r\n\t\t\t\t\t\t\t<div class='tutorial-end-icon3 web-activity-disable'></div>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t<div class='icon-tutorial-text'>\"+l10n.get(\"TutoEnd\")+\"</div>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t</div>\",\r\n\t\t\tstorage: false,\r\n\t\t\tbackdrop: true,\r\n\t\t\tsteps: steps\r\n\t\t});\r\n\r\nIt's done.\r\n\r\nSwitch to French into Sugarizer settings and relaunch the activity:\r\n\r\n![](images/tutorial_step9_6.png)\r\n\r\nCongratulation! Your activity has now a tutorial perfectly integrated into Sugarizer environment.\r\n\r\n[Go back to tutorial home](tutorial.md)\r\n"},"9d8c":function(t,e,n){"use strict";n.r(e),e["default"]="*(Estimated time: 15mn)*\r\n\r\nFor this tutorial, you will just need a browser and a text editor.\r\nWe will run Sugarizer from a local directory that will contain all files needed.\r\n\r\n### Create the Sugarizer directory\r\n\r\nTo start, download **Sugarizer** from [here](https://github.com/llaske/sugarizer/archive/dev.zip). It's a 260MB package so it could take some time. Once downloaded, unzip it.\r\n\r\nIf you're familiar with **git**, you could clone the repository - dev branch - instead like this:\r\n```shell\r\n\tgit clone -b dev https://github.com/llaske/sugarizer\r\n```\r\nWhatever method used, you should have at end a Sugarizer directory like this:\r\n\r\n![](images/tutorial_step0_2.png)\r\n\r\n\r\n### Run Sugarizer\r\n\r\nWe will use **Chrome** in this tutorial but any other browser will work as well.\r\n\r\nTo run Sugarizer locally in Chrome, close any running instances of Chrome and re-launch it using the command line:\r\n\r\n    chrome --allow-file-access-from-files index.html\r\n\r\n* On this line `chrome` is the name of the Chrome executable file. Depending of your system it could be `google-chrome` or `\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\"` or `open -n /Applications/Google\\ Chrome.app --args` instead.\r\n\r\n* The option `--allow-file-access-from-files` is required to enable access to local files using XMLHttpRequest. Equivalent options for other browser, see how to run *Sugarizer Application into the Web Browser* in [README.md](../README.md).\r\n\r\n* The `index.html` file is located in the new Sugarizer directory so you will have to use `cd` command line to change location to this directory before running the command.\r\n\r\nIf everything is right, you should see something like that:\r\n\r\n![](images/tutorial_step0_0.png)\r\n\r\nClick on \"New user\", type your name and choose your color, you should see the Sugarizer home view:\r\n\r\n![](images/tutorial_step0_1.png)\r\n\r\nTo debug your code, it's a good practice too to use the development console of your browser. See [here](https://developers.google.com/web/tools/chrome-devtools/) how to activate this console on Chrome.\r\n\r\n\r\n### Edit source code\r\n\r\nTo develop the activity and to update the source code you will need also a **text editor**. You could use for example [Lime](http://limetext.org/) on Linux, [Notepad++](https://notepad-plus-plus.org) on Windows, [Atom](https://atom.io/) on MacOS but any other text editor will work as well.\r\n\r\nLet's start by opening the Sugarizer directory in your favorite editor. You should see something like that:\r\n\r\n![](images/tutorial_step0_3.png)\r\n\r\nYou're now ready to start.\r\n"},"9d90":function(t,e,n){},b229:function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nIt\'s time now to implement the logic of our new activity.\r\n\r\nBecause the activity is called "Pawn", the idea is to allow the user to play pawns on the board.\r\n\r\nIn Sugar, the toolbar - the black area at the top of the window - is the place where activities put actions for the user. So we will add a new button in the toolbar to let the user play a new pawn.\r\n\r\n### Create a new toolbar button\r\n\r\nHere is the icon we will use. It\'s just a stylized plus sign.\r\n\r\n![](images/tutorial_step3_1.png)\r\n\r\nYou could download it [here](images/add.svg). Right-click on it and then save it as a SVG file in `icons/add.svg`.\r\n\r\n***Warning***: *The plus sign is white on a transparent background so you will see nothing if you display it on a white background.*\r\n\r\nTo add this icon in the toolbar, we will first update the `index.html` file for your activity. Look for the toolbar section in the file. It looks like this:\r\n```html\r\n<div id="main-toolbar" class="toolbar">\r\n\t<button class="toolbutton" id="activity-button" title="My Activity"></button>\r\n\r\n\t\x3c!-- Add more buttons here --\x3e\r\n\r\n\r\n\t\x3c!-- Buttons with class="pull-right" will be right aligned --\x3e\r\n\t<button class="toolbutton pull-right" id="stop-button" title="Stop"></button>\r\n</div>\r\n```\r\n\r\nLet\'s add our new button. It\'s just a `button` tag with the Sugar-Web `toolbutton` class. We give it the value `add-button` for the `id` property. Here is the result:\r\n```html\r\n<div id="main-toolbar" class="toolbar">\r\n\t<button class="toolbutton" id="activity-button" title="My Activity"></button>\r\n\r\n\t\x3c!-- Add more buttons here --\x3e\r\n\t<button class="toolbutton" id="add-button" title="Add pawn"></button>\r\n\r\n\t\x3c!-- Buttons with class="pull-right" will be right aligned --\x3e\r\n\t<button class="toolbutton pull-right" id="stop-button" title="Stop"></button>\r\n</div>\r\n```\r\n\r\nWe will now associate the icon to this new button. This association should be done in the `css/activity.css` file. Add these lines at the end of the file.\r\n```css\r\n#main-toolbar #add-button {\r\n\tbackground-image: url(../icons/add.svg);\r\n}\r\n```\r\nLet\'s run the activity.\r\n\r\n![](images/tutorial_step3_2.png)\r\n\r\nThe new toolbar button is now here. Click on it. Of course, nothing happens thought there is no logic beside. It\'s our next step.\r\n\r\n### Add the event\r\n\r\nTo display pawns on the board, we will first update our `index.html` file.\r\n\r\nAdd a new `div` tag below the one created for the welcome message:\r\n```html\r\n<div id="user"></div>\r\n<div id="pawns"></div>\r\n```\r\nWe give the value `pawns` for the attribute `id` because it will contain all pawns on the board.\r\n\r\nTo draw the pawn we will reuse our nice pawn icon. So each time there will be a click on the Plus button, we will add a new pawn icon on the board.\r\n\r\nLet\'s update the `activity/activity.js` to add this. But first, we will slightly adapt our `getEnvironment` call. We just add a `currentenv` variable to store the environment to avoid multiple call of the `getEnvironment` method:\r\n```js\r\n// Welcome user\r\nvar currentenv;\r\nenv.getEnvironment(function(err, environment) {\r\n\tcurrentenv = environment;\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+"Hello"+" "+environment.user.name+" !</h1>";\r\n});\r\n```\r\nThen just after the `getEnvironment` call, we will add the following event listener:\r\n```js\r\n// Handle click on add\r\ndocument.getElementById("add-button").addEventListener(\'click\', function (event) {\r\n\tvar pawn = document.createElement("div");\r\n\tpawn.className = "pawn";\r\n\r\n\tdocument.getElementById("pawns").appendChild(pawn);\r\n\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+currentenv.user.name+" played !</h1>";\r\n});\r\n```\r\n This source code does three things:\r\n\r\n * Declare a new event listener to add an action on the click event for the HTML element with the `id` value `add-button`, i.e. our toolbar button\r\n * Create a new `div` element with the `class` value `pawn` and append this element as child of our `pawns` `div`\r\n * Update the welcome message to indicate that a new pawn has been played by the user\r\n\r\nMake sense? Yes, except that something is missing: the link between the `div` created for the pawn and the pawn icon itself. To do that we have to update the `css/activity.css` file. Add these lines at the end of the file:\r\n```css\r\n.pawn {\r\n\tbackground-image: url(../icons/pawn-icon.svg);\r\n\tdisplay: inline-block;\r\n\twidth: 65px;\r\n\theight: 65px;\r\n}\r\n```\r\nIt defined a new CSS class named `pawn`, give it few cosmetic properties and specifically our pawn icon as background.\r\n\r\nCan\'t wait to run again our activity:\r\n\r\n![](images/tutorial_step3_3.png)\r\n\r\nWow, it works! Each time we will click on the Plus icon a new pawn will appear.\r\n\r\nBy the way, we could do better. What if we could change the pawn color?\r\n\r\n### Customize again the icon\r\n\r\nSugar activities very often rely on the user colors. It\'s a way to let the user think he could customize the color of activities. So, it\'s a good way to better engage him into the activity.\r\n\r\nWe decide to update our activity to paint the pawn with the user color. You could think it\'s complex: it\'s not! Just a call to another Sugar-Web library named **icon**.\r\n\r\nLet\'s reopen our `activity/activity.js` file.\r\nWe will first add the reference to this new library at the begining of the file. Update the first line with:\r\n```js\r\ndefine(["sugar-web/activity/activity", "sugar-web/env", "sugar-web/graphics/icon"], function (activity, env, icon) {\r\n```\r\nWe have now three dependancies: **activity**, **env** and **icon**.\r\n\r\nThe icon library contains a magic method called `colorize`. Just give it a reference to a Sugar-Web icon and a color and it will transform the background to a colorize icon.\r\n\r\nLet\'s add a call to this magic method just after the `appendChild` call:\r\n```js\r\ndocument.getElementById("pawns").appendChild(pawn);\r\nicon.colorize(pawn, currentenv.user.colorvalue);\r\n```\r\nVery simple, we call the method with two parameters: the new pawn element and the user color that we could find in the environment.\r\n\r\nThat\'s all. Let\'s play again with our activity:\r\n\r\n![](images/tutorial_step3_4.png)\r\n\r\nBeautiful isn\'t it?\r\n\r\nNote that if you\'re interested in how to integrate the Sugar UI in your activities, you could find more samples on this subject [here](http://sugarlabs.github.io/sugar-web-samples/).\r\n'},b318:function(t,e,n){"use strict";var r=n("d1f0"),i=n.n(r);i.a},be2f:function(t,e,n){"use strict";n.r(e),e["default"]={steps:{0:{},1:{indexTitle:{lang:"html",code:'\n<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset="utf-8" />\n  <title>Pawn Activity</title>\n  <meta name="viewport"\n    content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, viewport-fit=cover" />\n  <link rel="prefetch" type="application/l10n" href="locale.ini" />\n  <link rel="stylesheet" media="not screen and (device-width: 1200px) and (device-height: 900px)"\n    href="lib/sugar-web/graphics/css/sugar-96dpi.css">\n  <link rel="stylesheet" media="screen and (device-width: 1200px) and (device-height: 900px)"\n    href="lib/sugar-web/graphics/css/sugar-200dpi.css">\n  <link rel="stylesheet" href="css/activity.css">\n  <link rel="stylesheet" href="css/libnotify.css">\n  <link rel="stylesheet" href="css/bootstrap-tour-standalone.min.css">\n  <script>if (typeof module === \'object\') { window.module = module; module = undefined; }<\/script>\n  <script src="lib/vue.min.js"><\/script>\n  <script>if (typeof module === \'object\') { window.module = module; module = undefined; }<\/script>\n  <script src="lib/jquery-3.4.1.min.js"><\/script>\n  <script src="lib/bootstrap-tour-standalone.min.js"><\/script>\n  <script>if (window.module) module = window.module;<\/script>\n  <script src="lib/require.js"><\/script>\n</head>\n...\n        '}}}}},c34c:function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 30mn)*\r\n\r\nIn the previous step, we\'ve started to see how to use the unique Sugar UI. Let\'s see now another major feature of Sugar, the Journal, and how to handle it from our activity.\r\n\r\n# What is the Journal?\r\n\r\nLaunch the Paint activity from the Sugarizer home view.\r\n\r\n![](images/tutorial_step4_1.png)\r\n\r\nDraw something.\r\n\r\n![](images/tutorial_step4_2.png)\r\n\r\nThen stop the activity by clicking on the Stop button to the right.\r\n\r\nRelaunch it. You will retrieve the same drawing. That what the Journal is for: take care of your work without need to save it. Stop the activity again and go to the home view. Now just let the mouse on the Paint icon without clicking on it. A popup will appear after one second.\r\n\r\n![](images/tutorial_step4_3.png)\r\n\r\nClick on the **Start new** item.\r\n\r\nThis time a new drawing is created. Draw something else and click on the Paint icon to access the activity menu. Change the text to "*My second drawing*".\r\n\r\n\r\n![](images/tutorial_step4_4.png)\r\n\r\nStop the activity to go back to the Sugarizer home view. Then click on the Journal icon under the XO buddy icon.\r\n\r\n![](images/tutorial_step4_5.png)\r\n\r\nIt will display the Journal view. You will see here all your past work: the initial drawing and the second drawing that you\'ve renamed. Just click on one of these lines to relaunch the activity in the exact state where you leave it. That\'s why the Journal is so useful.\r\n\r\n![](images/tutorial_step4_6.png)\r\n\r\nNote that in the Journal you will see also your new Pawn activity. Let\'s see how we could handle context saving in this activity like Paint activity.\r\n\r\n# Identify the context\r\n\r\nThe "context" for our Pawn activity is the current number of pawns on the board. So a user could expect to retrieve the same number of pawns when he reopens the activity.\r\n\r\nLet\'s try to implement it. \r\n\r\nFirst we will slightly refactor (i.e. improve) our `js/activity.js` file. Here is the current implementation:\r\n```js\r\n// Handle click on add\r\ndocument.getElementById("add-button").addEventListener(\'click\', function (event) {\r\n\tvar pawn = document.createElement("div");\r\n\tpawn.className = "pawn";\r\n\r\n\tdocument.getElementById("pawns").appendChild(pawn);\r\n\ticon.colorize(pawn, currentenv.user.colorvalue);\r\n\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+currentenv.user.name+" played !</h1>";\r\n});\r\n```\r\nWe will refactor it to store pawns in an array `pawns` and to add a new method `drawPawn` to draw all icons at one time. So instead of adding a new `div` element on each button click, we just add a new element in the `pawns` array and we call the `drawPawn` icon to redraw the board. Here is the resulting code:\r\n```js\r\n// Draw pawns\r\nvar pawns = [];\r\nvar drawPawns = function() {\r\n\tdocument.getElementById("pawns").innerHTML = \'\';\r\n\tfor (var i = 0 ; i < pawns.length ; i++) {\r\n\t\tvar pawn = document.createElement("div");\r\n\t\tpawn.className = "pawn";\r\n\r\n\t\tdocument.getElementById("pawns").appendChild(pawn);\r\n\t\ticon.colorize(pawn, pawns[i]);\r\n\t}\r\n}\r\n\r\n// Handle click on add\r\ndocument.getElementById("add-button").addEventListener(\'click\', function (event) {\r\n\r\n\tpawns.push(currentenv.user.colorvalue);\r\n\tdrawPawns();\r\n\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+currentenv.user.name+" played !</h1>";\r\n});\r\n```\r\nThe array `pawns` contain all pawns. It\'s the context for our activity.\r\n\r\n# Store context in the datastore\r\n\r\nTo store the context, we have to handle the **datastore**. The datastore is the place where Sugar store the Journal. During the activity setup, Sugar-Web automatically initializes the datastore for the activity. The  `activity.getDatastoreObject()` method allows you to retrieve the datastore object allocated for the current activity.\r\nThe `setDataAsText` method on this object is a way to store a text string inside this object to retrieve it later.\r\nThe `save` method store the object when it has been updated.\r\n\r\nSo below is the source code to store the context in the datastore.\r\n\r\nFirst, convert the **pawns** array as JSON string and store it in the current object.\r\n```js\r\nvar jsonData = JSON.stringify(pawns);\r\nactivity.getDatastoreObject().setDataAsText(jsonData);\r\n```\r\nThen save the updated object.\r\n```js\r\nactivity.getDatastoreObject().save(function (error) {\r\n\tif (error === null) {\r\n\t\tconsole.log("write done.");\r\n\t} else {\r\n\t\tconsole.log("write failed.");\r\n\t}\r\n});\r\n```\r\nThis whole code should be called at the end of the activity. To do that we have to catch the click on the Stop button of the activity. So here is the complete source code we will add in the `activity/activity.js` file, just below the `add-button` event listener:\r\n```js\r\n\t// Save in Journal on Stop\r\n\tdocument.getElementById("stop-button").addEventListener(\'click\', function (event) {\r\n\t\tconsole.log("writing...");\r\n\t\tvar jsonData = JSON.stringify(pawns);\r\n\t\tactivity.getDatastoreObject().setDataAsText(jsonData);\r\n\t\tactivity.getDatastoreObject().save(function (error) {\r\n\t\t\tif (error === null) {\r\n\t\t\t\tconsole.log("write done.");\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log("write failed.");\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n```\r\n\r\nIt\'s the first step: the board is now safely saved in the datastore.\r\n\r\nLet\'s know how we could retrieve it.\r\n\r\n# Detect the need to load the context\r\n\r\nOur Pawn activity works well when it\'s called from the **Start new** menu, i.e. with a new instance. Because in that case, we don\'t have to reload the context.\r\nSo the first question to ask is: how to detect that we need to load the context?\r\n\r\nOnce again, the Sugar-Web environment could help us. When an activity is launched from an existing context, the environment contains an `objectId` property with the identifier for the datastore object. When an activity is launch with a new instance, this property is null.\r\n\r\nSo we will update our request on environment in `activity/activity.js` to test this variable:\r\n```js\r\nenv.getEnvironment(function(err, environment) {\r\n\tcurrentenv = environment;\r\n\tdocument.getElementById("user").innerHTML = "<h1>"+"Hello"+" "+environment.user.name+" !</h1>";\r\n\r\n\t// Load from datastore\r\n\tif (!environment.objectId) {\r\n\t\tconsole.log("New instance");\r\n\t} else {\r\n\t\tconsole.log("Existing instance");\r\n\t}\r\n});\r\n```\r\nLet\'s display the JavaScript console on your browser and test it. Launch the Pawn activity from the **Start new** menu or from List view of activities. Here is the result:\r\n\r\n![](images/tutorial_step4_7.png)\r\n\r\nNow open the Pawn activity from the Journal or by clicking on the Pawn icon on the Home view. Here is the result:\r\n\r\n\r\n![](images/tutorial_step4_8.png)\r\n\r\nOf course, the context is not loaded for the moment in the activity but at least we\'ve got a way to detect when it should be loaded and when it shouldn’t be loaded.\r\n\r\n\r\n# Load context from the datastore\r\n\r\nWhen our activity is launched with a new instance - the first branch from the previous `if` instruction, there is nothing to do. In that case, the `pawns` will be initialized with an empty array as today.\r\n\r\nWhen our activity is launched with an existing instance - the `else` branch, we have to load the context to init our `pawns` array.\r\n\r\nIn the same way that the `setAsText`/`save` methods, the datastore object provide a `loadAsText` method to retrieve the string stored in an object. So the code we will have to write to retrieve our context is:\r\n```js\r\nactivity.getDatastoreObject().loadAsText(function(error, metadata, data) {\r\n\tif (error==null && data!=null) {\r\n\t\tpawns = JSON.parse(data);\r\n\t}\r\n});\r\n```\r\nWe load the string - in the data parameter -, we parse it to an object and we set it in our `pawns` array. That\'s all for the initialization but we need also to draw it, so here is the full source code to write in `activity/activity.js`:\r\n\r\n```js\r\n// Load from datastore\r\nif (!environment.objectId) {\r\n\tconsole.log("New instance");\r\n} else {\r\n\tactivity.getDatastoreObject().loadAsText(function(error, metadata, data) {\r\n\t\tif (error==null && data!=null) {\r\n\t\t\tpawns = JSON.parse(data);\r\n\t\t\tdrawPawns();\r\n\t\t}\r\n\t});\r\n}\r\n```\r\nLet\'s try if it works.\r\n\r\nLaunch the Pawn activity from the **Start new** menu. Here is the result:\r\n\r\n![](images/tutorial_step4_9.png)\r\n\r\nThe activity displays a blank board as expected.\r\n\r\nClick a few times on the Plus button to add some pawns and stop the activity. Now re-open the activity by clicking on the Pawn icon on the Home view. Here is the result:\r\n\r\n![](images/tutorial_step4_10.png)\r\n\r\nYes! It\'s what we expected too: the activity reopens with the right number of pawns.\r\n\r\nThe Journal is now fully supported by the Pawn activity.\r\n'},c75e:function(t,e,n){},cf05:function(t,e,n){t.exports=n.p+"img/logo.82b9c7a5.png"},d1f0:function(t,e,n){},d6c5:function(t,e,n){"use strict";n.r(e),e["default"]='*(Estimated time: 15mn)*\r\n\r\nStep after step we\'ve added icons in the Pawn activity toolbar. In this new step we\'re going to improve our toolbar by exploring the creation of "Palette".\r\n\r\nIn [step 6](tutorial_step6.md) of this tutorial, we\'ve added a specific icon in the toolbar for the "Presence Palette". In the Sugar UI, the name "palette" refers to a popup menu in the toolbar. When the user clicks on the toolbar icon, the popup appears and shows items inside.\r\n\r\n![](images/tutorial_step8_1.png)\r\n\r\nAs we\'ve seen briefly in [step 6](tutorial_step6.md#add-the-presence-palette), to handle this feature Sugar-Web exposes a Palette library. Let\'s see how we could use this library to create our own palette.\r\n\r\n\r\n### Create the palette file\r\n\r\nTo create a new palette, you should first create a new palette file. This file will contain the source code to handle palette behavior.\r\n\r\nSo, create a new file named `pawnpalette.js` in the `Pawn.activity/lib` directory.\r\n\r\n***Warning***: *The file should not be created in the `Pawn.activity/src` because palettes are considered to be new libraries.*\r\n\r\nHere\'s the source code to insert into the new Pawn palette file:\r\n\r\n\r\n    define(["sugar-web/graphics/palette"], function(palette) {\r\n\r\n    \tvar pawnpalette = {};\r\n\r\n    \tpawnpalette.PawnPalette = function(invoker, primaryText) {\r\n    \t\tpalette.Palette.call(this, invoker, primaryText);\r\n\r\n    \t\tvar template = \'<strong>Hello palette!</strong>\';\r\n    \t\tvar containerElem = document.createElement(\'div\');\r\n    \t\tcontainerElem.innerHTML = template;\r\n    \t\tthis.setContent([containerElem]);\r\n    \t};\r\n\r\n    \tvar addEventListener = function(type, listener, useCapture) {\r\n    \t\treturn this.getPalette().addEventListener(type, listener, useCapture);\r\n    \t};\r\n\r\n    \tpawnpalette.PawnPalette.prototype = Object.create(palette.Palette.prototype, {\r\n    \t\taddEventListener: {\r\n    \t\t\tvalue: addEventListener,\r\n    \t\t\tenumerable: true,\r\n    \t\t\tconfigurable: true,\r\n    \t\t\twritable: true\r\n    \t\t}\r\n    \t});\r\n\r\n    \treturn pawnpalette;\r\n    });\r\n\r\n\r\nAs we\'ve already seen in [step 2](tutorial_step2.md#customize-content), the `define` function is a way to define a new module and express its dependencies. Here we\'re going to define a new module that depends on the JavaScript library `sugar-web/graphics/palette`. This `palette` library is precisely the base class for all Palette objects.\r\n\r\nSo, our new module creates a new `PawnPalette` object and initialize it by calling the Palette constructor with `palette.Palette.call`.\r\n\r\nYou don\'t need to understand in detail how it works but the important part here is that the Palette content should be set by a call of the `palette.setContent` function.\r\n\r\nHere, the content is just a HTML div element with a simple string `\'<strong>Hello palette!</strong>\'` inside. In most complex palettes, the content could come from a HTML file or could be a generated set of items.\r\n\r\n\r\n### Integrate the palette in the toolbar\r\n\r\nLet\'s now integrate our new palette in the toolbar.\r\n\r\nIt could be done by adding a new button in the toolbar as we\'ve done in [step 3](tutorial_step3.md#Create-a-new-toolbar-button). But here we\'re going to redefine the behavior for the current **Add** button instead.\r\n\r\nTo do that, let\'s update our `js/activity.js` file.\r\n\r\nAs usual, to integrate new features, we will first update the dependencies list of libraries at the first line of the file.\r\n\r\n\tdefine(["sugar-web/activity/activity", ... ,"sugar-web/graphics/journalchooser","pawnpalette"], function (activity, ... ,presencepalette, datastore, journalchooser, pawnpalette) {\r\n\r\nThis time you need to add the `pawnpalette` library created before. Add the string `"pawnpalette"` at the end of dependencies array and declare a new `pawnpalette` variable at the end of the function declaration.\r\n\r\nLet\'s now create the palette and associate it to the icon. Add the following code just before the `addEventListener(\'click\',...)` call for the add button:\r\n\r\n    var addpalette = new pawnpalette.PawnPalette(document.getElementById("add-button"), "Add pawn");\r\n\r\nThis source code call create the `PawnPalette` object and call the constructor with two parameters:\r\n\r\n * the first one is the toolbar button to associate the palette. As we said, we\'re reusing our **Add** button.\r\n * the second one is the header for the palette. It\'s an optional parameter used to display a label at the beginning of the palette to explain the palette objective to the user. Here we set `"Add pawn"`.\r\n\r\nLet\'s run the Pawn activity. Now, when you click on the add toolbar button the palette is displayed.\r\n\r\n![](images/tutorial_step8_2.png)\r\n\r\nFunny isn\'t it?\r\n\r\nAs an exercise, look what happens when you do not provide a second parameter to the constructor.\r\n\r\n\r\n### Customize the palette content\r\n\r\nNow that we\'ve seen basic concepts of the palette, it\'s time to improve the UI for our custom palette.\r\n\r\nSpecifically, we\'re going to update our palette to allow users to add between 1 and 3 pawns at the same time.\r\n\r\nHere\'s the final look we would like to obtain:\r\n\r\n\r\n![](images/tutorial_step8_3.png)\r\n\r\nWe would like to have 3 items each one that gives an opportunity to users to add a different number of pawns. To explore palette features each item will have a different UI: a text, an image, a text and an image combined.\r\n\r\nTo do that, we\'re going to use a HTML file to describe the palette UI. So let\'s create a new file named `pawnpalette.html` in the `Pawn.activity/lib` directory, at the same place as the `pawnpalette.js`.\r\n\r\nPut the content above in this new file:\r\n\r\n    <div id="item-one" class="palette-item">\r\n      One\r\n    </div>\r\n    <div id="item-two" class="palette-item item-icon">\r\n      <img src="icons/pawn-icon.svg" class="palette-icon">\r\n      <img src="icons/pawn-icon.svg" class="palette-icon">\r\n    </div>\r\n    <div id="item-three" class="palette-item item-icon">\r\n      <span class="palette-text">3 x </span><img src="icons/pawn-icon.svg" class="palette-icon">\r\n    </div>\r\n\r\nIt creates three `div` elements, each one represent an item and its specific UI. The HTML tags are linked to some new CSS styles. So add to the existing `css/activity.css` file the following content:\r\n\r\n    .palette-item {\r\n      width: 200px;\r\n      height: 30px;\r\n      padding-top: 15px;\r\n      padding-left: 10px;\r\n    }\r\n\r\n    .palette-item:hover {\r\n      background-color: #808080;\r\n    }\r\n\r\n    .palette-icon {\r\n      width: 30px;\r\n    }\r\n\r\n    .palette-text {\r\n      vertical-align: super;\r\n    }\r\n\r\n    .item-icon {\r\n      padding-top: 3px;\r\n      height: 40px;\r\n    }\r\n\r\nThen we need to update the palette source code to use this HTML file as template for the palette.\r\n\r\nFirst, let\'s update the first line that define the module. We\'re going to add a new dependancy on the `pawnpalette.html` file. Here\'s the line once updated:\r\n\r\n    define(["sugar-web/graphics/palette","text!pawnpalette.html"], function(palette, template) {\r\n\r\n\r\nThe `text!` prefix before the file name tell to **require.js** framework to process the file as text content instead of JavaScript.\r\n\r\nThen, because the `template` variable is now initialized by the `define` function, you could remove the line:\r\n\r\n    var template = \'<strong>Hello palette!</strong>\';\r\n\r\nThat\'s all. We\'re now ready to display our customized palette.\r\n\r\nLet\'s try by running the Pawn activity again.\r\n\r\n\r\n![](images/tutorial_step8_4.png)\r\n\r\n\r\nWaoow. Very beautiful!\r\n\r\n\r\n### Handle palette event\r\n\r\nFrom the beginning of this lesson, the event handler for the **Add** button is still the same. So, when you click on the button to open the palette, a new pawn appears. And when you click again to close the palette a new pawn appears again. Of course, it\'s not the expected behavior. It\'s why we need to change the event.\r\n\r\nThe first thing to do is to create a custom event for our palette. This event will be raise by the palette when the user will click one of the three items. Here\'s the source code to do that:\r\n\r\n    this.pawnClickEvent = document.createEvent(\'CustomEvent\');\r\n    this.pawnClickEvent.initCustomEvent(\'pawnClick\', true, true, { count: 0 });\r\n\r\nThis code should be add in the `pawnpalette.js` file, just after the `setContent` call. It will create a new HTML Custom Event named `pawnClick` with a parameter `count` set to 0 by default.\r\n\r\nThen let\'s set the event handler for our three items. Following is the code to do that. You should add it below the previous one.\r\n\r\n\tvar that = this;\r\n\tdocument.getElementById("item-one").addEventListener(\'click\', function(event) {\r\n\t\tthat.pawnClickEvent.count = 1;\r\n\t\tthat.getPalette().dispatchEvent(that.pawnClickEvent);\r\n\t\t});\r\n\tdocument.getElementById("item-two").addEventListener(\'click\', function(event) {\r\n\t\tthat.pawnClickEvent.count = 2;\r\n\t\tthat.getPalette().dispatchEvent(that.pawnClickEvent);\r\n\t\tthat.popDown();\r\n\t});\r\n\tdocument.getElementById("item-three").addEventListener(\'click\', function(event) {\r\n\t\tthat.pawnClickEvent.count = 3;\r\n\t\tthat.getPalette().dispatchEvent(that.pawnClickEvent);\r\n\t\tthat.popDown();\r\n\t});\r\n\r\nThis code adds a click listener for each line referenced in our palette UI. As you could check in the `pawnpalette.html` file, `item-one`, `item-two` and `item-three` are identifiers for each line in the palette.\r\nEach listener starts by setting the `count` parameter of the custom event. Then it calls the `dispatchEvent` on the palette object to raise the event.\r\nFinally, the listener calls the palette `popDown` method that, like you could expect, hide/close the palette. To let you see the difference the first item doesn\'t call this method.\r\n\r\nThat\'s all for the palette part. Let\'s now update the `js/activity.js` file to catch the new custom event.\r\n\r\nReplace the `document.getElementById("add-button").addEventListener(...)` call by this new source code:\r\n\r\n\taddpalette.addEventListener(\'pawnClick\', function (event) {\r\n\t\tfor (var i = 0 ; i < event.count ; i++) {\r\n\t\t\tpawns.push(currentenv.user.colorvalue);\r\n\t\t\tdrawPawns();\r\n\r\n\t\t\tdocument.getElementById("user").innerHTML = "<h1>"+webL10n.get("Played", {name:currentenv.user.name})+"</h1>";\r\n\r\n\t\t\tif (presence) {\r\n\t\t\t\tpresence.sendMessage(presence.getSharedInfo().id, {\r\n\t\t\t\t\tuser: presence.getUserInfo(),\r\n\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\taction: \'update\',\r\n\t\t\t\t\t\tdata: currentenv.user.colorvalue\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\nShortly, it replaces the `click` listener on the **Add** button by a custom event `pawnClick` listener on the palette.\r\nThe source code for the listener is pretty the same as the old one. The only difference is a loop around the old source code. It repeats that as many times as the value of the count event property.\r\n\r\nLet\'s test it.\r\n\r\n\r\n![](images/tutorial_step8_5.png)\r\n\r\nOpen the palette by clicking on the **Add** icon.\r\n\r\nTry to click on the first item, it adds one pawn on the board.\r\n\r\nTry to click on the second item, it adds two pawns on the board and close the palette.\r\n\r\nTry to click on the third item, it adds three pawns on the board and close the palette too.\r\n\r\nThat\'s exactly what we expected!\r\n\r\nVoila! now you are able to create your own custom palette and how to add an event into it. Note however that there are multiple ways to handle palettes. You could attach methods to the palette or generate its content using HTML generators like the included **Mustache** framework.\r\n\r\nTo learn more, I suggest you to explore the source code for other activities that use palettes, for example [Paint](../activities/Paint.activity) or [Speak](../activities/Speak.activity). You could study for example how the Color palette, used in multiple activities, works.\r\n\r\n\r\n[Go to next step](tutorial_step9.md)\r\n'},e5fc:function(t,e,n){"use strict";n.r(e),e["default"]="*(Estimated time: 15mn)*\r\n\r\nFor this tutorial, you will just need a browser and a text editor.\r\nWe will run Sugarizer from a local directory that will contain all files needed.\r\n\r\n### Create the Sugarizer directory\r\n\r\nTo start, download **Sugarizer** from [here](https://github.com/llaske/sugarizer/archive/dev.zip). It's a 320MB package so it could take some time. Once downloaded, unzip it.\r\n\r\nIf you're familiar with **git**, you could clone the repository - dev branch - instead like this:\r\n```shell\r\n\tgit clone -b dev https://github.com/llaske/sugarizer\r\n```\r\nWhatever method used, you should have at end a Sugarizer directory like this:\r\n\r\n![](images/tutorial_step0_2.png)\r\n\r\n\r\n### Run Sugarizer\r\n\r\nWe will use **Chrome** in this tutorial but any other browser will work as well.\r\n\r\nTo run Sugarizer locally in Chrome, close any running instances of Chrome and re-launch it using the command line:\r\n\r\n    chrome --allow-file-access-from-files index.html\r\n\r\n* On this line `chrome` is the name of the Chrome executable file. Depending of your system it could be `google-chrome` or `\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\"` or `open -n /Applications/Google\\ Chrome.app --args` instead.\r\n\r\n* The option `--allow-file-access-from-files` is required to enable access to local files using XMLHttpRequest. Equivalent options for other browser, see how to run *Sugarizer Application into the Web Browser* in [README.md](../README.md).\r\n\r\n* The `index.html` file is located in the new Sugarizer directory so you will have to use `cd` command line to change location to this directory before running the command.\r\n\r\nIf everything is right, you should see something like that:\r\n\r\n![](images/tutorial_step0_0.png)\r\n\r\nClick on \"New user\", type your name and choose your color, you should see the Sugarizer home view:\r\n\r\n![](images/tutorial_step0_1.png)\r\n\r\nTo debug your code, it's a good practice too to use the development console of your browser. See [here](https://developers.google.com/web/tools/chrome-devtools/) how to activate this console on Chrome.\r\n\r\n\r\n### Edit source code\r\n\r\nTo develop the activity and to update the source code you will need also a **text editor**. You could use for example [Lime](http://limetext.org/) on Linux, [Notepad++](https://notepad-plus-plus.org) on Windows, [Atom](https://atom.io/) on MacOS but any other text editor will work as well.\r\n\r\nLet's start by opening the Sugarizer directory in your favorite editor. You should see something like that:\r\n\r\n![](images/tutorial_step0_3.png)\r\n\r\nYou're now ready to start.\r\n"}});
//# sourceMappingURL=app.f328c7fe.js.map